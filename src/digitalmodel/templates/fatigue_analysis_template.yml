# Fatigue Analysis Template
# Comprehensive template for fatigue damage calculation and life assessment
# Supports multiple fatigue curves and standards (DNV, API, ASME, BS)

# Template metadata
template_info:
  name: "Fatigue Analysis Template"
  version: "1.0.0"
  description: "Comprehensive fatigue analysis template supporting multiple standards and curves"
  created_date: "2025-01-15"
  engineering_standards:
    - "DNV-RP-C203"
    - "API RP 2A-WSD"
    - "ASME VIII Div 2"
    - "BS 7910"
  analysis_type: "fatigue_damage"

basename: fatigue_analysis

# Default configuration
default:
  log_level: DEBUG  # Options: DEBUG, INFO, WARNING, ERROR
  units:
    stress: "MPa"  # Options: MPa, Pa, psi, ksi
    time: "years"  # Options: years, hours, seconds, cycles
    frequency: "Hz"  # Options: Hz, rpm, cycles/year
    length: "m"  # Options: m, mm, ft, in
    temperature: "C"  # Options: C, F, K
  config:
    overwrite:
      output: true
    save_intermediate_results: true
    generate_plots: true

# Fatigue data input configuration
fatigue_data:
  csv: true  # Use CSV input for stress time series
  io: "examples/input_files/fatigue_analysis/fatigue_data.csv"
  format: "time_series"  # Options: time_series, rainflow_cycles, cycle_counts
  columns:
    time: "time"  # Time column name
    stress: "stress"  # Stress column name
    mean_stress: "mean_stress"  # Mean stress (optional)
    stress_range: "stress_range"  # Stress range (for cycle input)
    cycle_count: "cycles"  # Cycle count (for cycle input)

# Analysis input parameters
inputs:
  software: "digitalmodel"  # Analysis software identifier
  calculation_type: "damage"  # Options: damage, life, sn_curve_fitting

  # Fatigue curve selection
  fatigue_curve: "DNV 2005 C2 Seawater CP"  # Primary fatigue curve

  # Alternative curves for comparison
  alternative_curves:
    - "DNV 2005 D Seawater CP"
    - "API RP 2A X-X'"
    - "ASME VIII Div 2 Austenitic"

  # Environmental conditions
  environment:
    medium: "seawater"  # Options: air, seawater, sour_service
    temperature: 15.0  # Environmental temperature
    cathodic_protection: true  # CP system present
    coating_condition: "good"  # Options: good, fair, poor, none

  # Material properties
  material:
    type: "steel"  # Material type
    grade: "S355"  # Material grade
    yield_strength: 355  # MPa
    ultimate_strength: 510  # MPa
    elastic_modulus: 210000  # MPa
    endurance_limit: 160  # MPa (if applicable)

  # Design parameters
  design:
    design_life: 25  # Design life in years
    safety_factor: 10.0  # Design fatigue factor (DFF)
    inspection_strategy: "periodic"  # Options: periodic, continuous, none
    inspection_interval: 5  # Years between inspections
    target_reliability: 0.999  # Target reliability level

# Stress analysis configuration
stress_analysis:
  method: "rainflow"  # Options: rainflow, simple_range, peak_valley

  # Rainflow counting parameters
  rainflow:
    hysteresis: 0.0  # Hysteresis threshold
    small_cycle_threshold: 0.05  # Fraction of max range
    mean_stress_correction: "Goodman"  # Options: Goodman, Gerber, Soderberg, Walker

  # Stress concentration factors
  stress_concentration:
    geometry_factor: 1.0  # Kt - theoretical stress concentration
    fatigue_factor: 1.0  # Kf - fatigue stress concentration
    surface_factor: 1.0  # Surface finish factor
    size_factor: 1.0  # Size effect factor
    load_factor: 1.0  # Load type factor

  # Multi-axial stress handling
  multiaxial:
    criterion: "von_mises"  # Options: von_mises, principal, critical_plane
    phase_relationship: 0.0  # Phase angle for combined loading (degrees)

# Fatigue curves database
fatigue_curves:
  # DNV-RP-C203 curves
  "DNV 2005 B1 Air":
    standard: "DNV-RP-C203"
    environment: "air"
    log_a: 15.117
    m: 4.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e8
    thickness_correction: true

  "DNV 2005 C Seawater CP":
    standard: "DNV-RP-C203"
    environment: "seawater_cp"
    log_a: 12.164
    m: 3.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e7
    thickness_correction: true

  "DNV 2005 C2 Seawater CP":
    standard: "DNV-RP-C203"
    environment: "seawater_cp"
    log_a: 12.049
    m: 3.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e7
    thickness_correction: true

  "DNV 2005 D Seawater CP":
    standard: "DNV-RP-C203"
    environment: "seawater_cp"
    log_a: 11.764
    m: 3.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e7
    thickness_correction: true

  # API RP 2A curves
  "API RP 2A X-X'":
    standard: "API RP 2A-WSD"
    environment: "seawater"
    log_a: 12.0
    m: 3.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e7
    thickness_correction: false

  "API RP 2A T-T'":
    standard: "API RP 2A-WSD"
    environment: "air"
    log_a: 14.0
    m: 4.0
    reference_cycles: 2000000
    cutoff_limit: 1.0e8
    thickness_correction: false

  # ASME VIII Division 2 curves
  "ASME VIII Div 2 Austenitic":
    standard: "ASME VIII Div 2"
    environment: "air"
    log_a: 13.94
    m: 3.5
    reference_cycles: 2000000
    cutoff_limit: 1.0e8
    thickness_correction: true

  "ASME VIII Div 2 Carbon Steel":
    standard: "ASME VIII Div 2"
    environment: "air"
    log_a: 13.61
    m: 3.2
    reference_cycles: 2000000
    cutoff_limit: 1.0e8
    thickness_correction: true

# Load spectrum definition
load_spectrum:
  type: "measured"  # Options: measured, analytical, standard

  # For measured data
  measured:
    duration: 8760  # Hours of measurement
    sampling_frequency: 10  # Hz
    scaling_factor: 1.0  # Scale factor for design life

  # For analytical spectrum
  analytical:
    mean_stress: 50.0  # MPa
    stress_amplitude: 100.0  # MPa
    frequency: 0.1  # Hz
    spectrum_type: "constant"  # Options: constant, variable, random

  # Standard load spectra
  standard:
    spectrum_name: "offshore_platform"  # Predefined spectrum
    sea_state: "North_Sea"
    return_period: 100  # years

# Analysis options
analysis_options:
  # Damage calculation methods
  damage_calculation:
    method: "palmgren_miner"  # Linear damage accumulation
    interaction_effects: false  # Include load interaction effects
    sequence_effects: false  # Include load sequence effects

  # Uncertainty and reliability
  uncertainty:
    include_scatter: true  # Include S-N curve scatter
    scatter_factor: 2.0  # Two-sided 95% confidence interval
    stress_uncertainty: 0.1  # Coefficient of variation for stress
    curve_uncertainty: 0.2  # Coefficient of variation for S-N curve

  # Advanced analysis options
  advanced:
    crack_growth: false  # Include crack growth analysis
    variable_amplitude: true  # Variable amplitude loading effects
    mean_stress_effects: true  # Include mean stress effects
    temperature_effects: false  # Include temperature effects

# Output configuration
output:
  summary:
    damage_ratio: true  # Total damage ratio
    remaining_life: true  # Remaining fatigue life
    critical_location: true  # Most critical location

  detailed:
    cycle_counting: true  # Cycle counting results
    stress_ranges: true  # Stress range histogram
    damage_contribution: true  # Damage contribution by stress range

  plots:
    sn_curve: true  # S-N curve plot
    stress_time_history: true  # Stress vs time plot
    rainflow_matrix: true  # Rainflow counting matrix
    damage_spectrum: true  # Damage vs stress range

  reports:
    summary_report: true  # Executive summary
    detailed_report: true  # Detailed calculations
    compliance_report: true  # Code compliance check

# Validation and quality control
validation:
  data_quality:
    missing_data_limit: 0.05  # Maximum fraction of missing data
    outlier_detection: true  # Detect and flag outliers
    data_smoothing: false  # Apply data smoothing

  calculation_checks:
    range_checks: true  # Check for reasonable stress ranges
    curve_validity: true  # Verify fatigue curve applicability
    life_estimates: true  # Check for reasonable life estimates

  reporting:
    uncertainty_bounds: true  # Report confidence intervals
    sensitivity_analysis: false  # Perform sensitivity analysis
    documentation: "detailed"  # Level of documentation

# Multiple analysis cases
cases:
  - case_id: "nominal"
    description: "Nominal design conditions"
    load_factor: 1.0
    curve_modifier: 1.0

  - case_id: "conservative"
    description: "Conservative assessment with safety margins"
    load_factor: 1.2
    curve_modifier: 0.8

  - case_id: "optimistic"
    description: "Best estimate with mean curve"
    load_factor: 0.9
    curve_modifier: 1.2

# Database configuration (optional)
database:
  enabled: false  # Enable database storage
  connection:
    type: "postgresql"
    host: "localhost"
    port: 5432
    database: "fatigue_db"
    username: "user"
    password: "password"

  storage:
    time_series: true  # Store time series data
    results: true  # Store analysis results
    metadata: true  # Store analysis metadata

# Validation rules for template validator
validation_rules:
  required_fields:
    - "fatigue_data.io"
    - "inputs.fatigue_curve"
    - "inputs.design.design_life"
    - "inputs.design.safety_factor"

  value_ranges:
    design_life: [1, 200]  # years
    safety_factor: [1.0, 20.0]
    stress_ranges: [0.1, 2000]  # MPa
    cycle_counts: [1, 1e10]

  curve_validation:
    log_a_range: [8.0, 20.0]
    m_range: [2.0, 6.0]
    cutoff_range: [1e6, 1e9]

# Usage examples and documentation
usage_examples:
  basic_analysis:
    description: "Basic fatigue life calculation from stress time series"
    steps:
      - "Load stress time history from CSV file"
      - "Apply rainflow cycle counting"
      - "Calculate damage using Palmgren-Miner rule"
      - "Determine remaining fatigue life"

  comparative_study:
    description: "Compare fatigue life using different S-N curves"
    steps:
      - "Define multiple fatigue curves"
      - "Calculate damage for each curve"
      - "Compare results and select appropriate curve"
      - "Document rationale for curve selection"

  reliability_assessment:
    description: "Probabilistic fatigue assessment with uncertainties"
    steps:
      - "Define uncertainty parameters"
      - "Perform Monte Carlo simulation"
      - "Calculate reliability indices"
      - "Determine inspection intervals"

# References and standards
references:
  - "DNV-RP-C203, Fatigue design of offshore steel structures"
  - "API RP 2A-WSD, Planning, Designing and Constructing Fixed Offshore Platforms"
  - "ASME Boiler and Pressure Vessel Code, Section VIII, Division 2"
  - "BS 7910, Guide to methods for assessing the acceptability of flaws in metallic structures"
  - "IIW Recommendations for Fatigue Design of Welded Joints and Components"
  - "AISC 360, Specification for Structural Steel Buildings"
  - "EN 1993-1-9, Eurocode 3: Design of steel structures - Part 1-9: Fatigue"

# Usage notes
usage_notes: |
  This template provides comprehensive configuration for fatigue analysis calculations.

  Key features:
  1. Multiple fatigue curve support (DNV, API, ASME, BS standards)
  2. Advanced cycle counting with rainflow algorithm
  3. Mean stress correction methods
  4. Environmental effects (seawater, CP, temperature)
  5. Uncertainty and reliability assessment
  6. Multi-axial stress handling
  7. Variable amplitude loading effects

  To use this template:
  1. Prepare stress time series data in CSV format
  2. Select appropriate fatigue curve for your application
  3. Define material properties and environmental conditions
  4. Set design life and safety factors
  5. Run analysis and review results
  6. Perform sensitivity studies if needed

  For complex structures, consider using multiple analysis points
  and combining results using appropriate methodologies.