# API STD 2RD Pipeline Design Template
# This template provides comprehensive configuration for API STD 2RD pipeline design calculations
# Reference: API STD 2RD-2013 Section 5 - Design of Pipeline Systems

# Metadata
basename: pipe_capacity
template_version: "1.0.0"
template_description: "API STD 2RD pipeline design template for subsea and offshore pipelines"
created_date: "2025-01-15"
engineering_standard: "API STD 2RD-2013 Section 5"

# Default configuration settings
default:
  Constants:
    g: {m/s2: 9.81, in/s2: 386.09, ft/s2: 32.174}
  units:
    Distance: ft  # Options: ft, m, mm, in
    declinationAngle: "deg with vertical"
    Temperature: "deg F"  # Options: deg F, deg C, K
    Pressure: psi  # Options: psi, Pa, kPa, MPa, bar
    EffectiveTension: kN  # Options: kN, N, lbf, kip
    AxialForce: kN
    BendingMoment: kNm  # Options: kNm, Nm, ft-lbf, in-lbf
    YieldStrength: psi
    E: psi  # Young's modulus
    NominalID: inch  # Options: inch, mm, m
    NominalOD: inch
    NominalWT: inch
    Rho: lb/inch3  # Material density
    MassPerUnitLength: lb/ft
    WeightPerUnitLength: lb/ft
    SoilStiffness: kN/m/m
    BuoyancyCoverage: Percentage
    ThermalExpansionCoefficient: "in/in/deg F"
  log_level: DEBUG  # Options: DEBUG, INFO, WARNING, ERROR
  config:
    overwrite:
      output: true  # Overwrite existing output files

# Database configuration (optional)
db:
  dev:
    server_type: postgresql  # Options: postgresql, mysql, sqlite
    server: localhost
    user: postgres
    password: docker  # Use environment variables in production
    database: acedb
    port: 5000

# General project parameters
General:
  Water_Depth: 2460.63  # Water depth in project units
  Project_Name: "Example Pipeline Project"  # Optional project identifier
  Design_Life: 25  # Design life in years
  Installation_Method: "S-lay"  # Options: S-lay, J-lay, Reel-lay, Pull-in

# Outer pipe configuration
Outer_Pipe:
  Geometry:
    Nominal_OD: 18.0  # Nominal outside diameter
    Nominal_ID: null  # Nominal inside diameter (calculated if null)
    Design_WT: 0.75  # Design wall thickness
    Corrosion_Allowance: 0.125  # Corrosion allowance thickness
    Length_Segment: 1000.0  # Segment length for analysis

  Material:
    Material: Steel  # Material type
    Material_Grade: "API 5L X60"  # Material grade per API 5L
    WeldFactor:
      Seamless: 1.0  # Weld efficiency factor for seamless pipe
      ERW: 0.8  # Electric resistance welded
      SAW: 1.0  # Submerged arc welded
    Insulation: null  # Insulation thickness if applicable
    Buoyancy: null  # Buoyancy modules specification

  Manufacturing:
    Coupling_Mass_Ratio: 0.1  # Additional mass from couplings/connectors
    Fabrication_Tolerance: 0.01  # Manufacturing tolerance factor

# Inner pipe configuration (for pipe-in-pipe systems)
Inner_Pipe:
  # Set to null for single pipe systems
  # For pipe-in-pipe, use similar structure as Outer_Pipe
  Geometry:
    Nominal_OD: null
    Nominal_ID: null
    Design_WT: null
    Corrosion_Allowance: null
  Material:
    Material: null
    Material_Grade: null

# Design conditions and load cases
Design:
  - Load_Condition: {Outer_Pipe: internal_pressure}  # Primary load condition
    InternalPressure: {Outer_Pipe: 2220}  # Internal pressure in psi
    InternalFluid: {Outer_Pipe: 0.03703047}  # Internal fluid density lb/in3
    ExternalPressure: {Outer_Pipe: 0}  # External pressure differential
    ExternalFluid: {Outer_Pipe: 0.03703047}  # External fluid density (seawater)
    Temperature:
      Ambient: {Outer_Pipe: 50}  # Ambient temperature deg F
      Operating: {Outer_Pipe: 82}  # Operating temperature deg F
      Maximum: {Outer_Pipe: 120}  # Maximum temperature deg F
      Installation: {Outer_Pipe: 32}  # Installation temperature
    BendingMoment: 0  # Applied bending moment
    AxialForce: 0  # Applied axial force
    Torsion: 0  # Applied torsional moment
    Condition: Restrained  # Options: Restrained, Unrestrained, Partially_Restrained
    Water_Depth: 2460.63  # Local water depth
    Hydrostatic_Test_Factor: 1.25  # Hydrostatic test pressure factor
    Code:
      - {Outer_Pipe: "API STD 2RD-2013 Section 5"}

# Design factors per various codes and standards
DesignFactors:
  # API STD 2RD-2013 Section 5
  "API STD 2RD-2013 Section 5":
    internal_pressure:
      Fd: 0.60  # Design factor for internal pressure
      k: 0.45  # Location factor (API 5L, API 5CT, ASME)
    external_pressure:
      Fd: 0.70  # Design factor for external pressure
    longitudinal_stress:
      Fd: 0.80  # Design factor for longitudinal stress
    equivalent_stress:
      Fd: 0.90  # Design factor for equivalent stress
    D_over_T_Transition_Ratio: 30  # D/t ratio transition limit

  # ASME B31.4-2016 (Liquid Petroleum Transportation)
  "ASME B31.4-2016 Chapter IX Pipeline":
    internal_pressure: 0.72
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  "ASME B31.4-2016 Chapter IX Platform Piping":
    internal_pressure: 0.60
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  "ASME B31.4-2016 Chapter IX Risers":
    internal_pressure: 0.60
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  # ASME B31.8-2016 (Gas Transmission and Distribution)
  "ASME B31.8-2016 Chapter VIII Pipeline":
    internal_pressure: 0.72
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  "ASME B31.8-2016 Chapter VIII Platform Piping":
    internal_pressure: 0.50
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  "ASME B31.8-2016 Chapter VIII Risers":
    internal_pressure: 0.50
    Longitudinal: 0.80
    EquivalentStress: 0.90
    D_over_T_Transition_Ratio: 30

  # API RP 1111 (Design and Hazard Assessment for Offshore Production Riser Systems)
  "API RP 1111-2009 Risers":
    internal_pressure:
      Fd: 0.60
    collapse_propagation:
      Fp: 0.80
    D_over_T_Transition_Ratio: 15

  "API RP 1111-2009 Pipelines":
    internal_pressure:
      Fd: 0.72
    collapse_propagation:
      Fp: 0.80
    D_over_T_Transition_Ratio: 30

  # API RP 16Q (Design, Selection, Operation and Maintenance of Marine Drilling Riser Systems)
  "API RP 16Q-2017":
    internal_pressure:
      Fd: 0.67
    external_pressure:
      Fd: 0.70
      section: 5.5
      cross_reference: "API TR 5C3-2018"

  # 30 CFR Part 250 (US Federal Regulations)
  "30 CFR Part 250":
    release_date: 2019
    internal_pressure:
      Fd: 0.6

# Fatigue analysis parameters
Fatigue:
  serviceLife: 25  # Service life in years
  singleULSEvent: null  # Single ultimate limit state event definition
  singleALSEvent: null  # Single accidental limit state event definition
  fatigue_curves:
    - "DNV-RP-C203 D-curve"  # Available fatigue curves
    - "API RP 2A-WSD"
    - "ASME VIII Div 2"
  safety_factors:
    fatigue_design_factor: 10.0  # Design fatigue factor
    inspection_strategy: "Periodic"  # Options: Periodic, Continuous, None

# Material properties database
Material:
  Steel:
    E: 30000000.0  # Young's modulus in psi
    Rho: 0.2817929  # Density in lb/in3
    Poissons_ratio: 0.30  # Poisson's ratio
    ThermalExpansionCoefficient: 6.5E-6  # in/in/deg F
    Grades:
      "API 5L X42":
        SMYS: 42000  # Specified minimum yield strength
        SMUS: 60000  # Specified minimum ultimate strength
        Reference: "API 5L specification"
      "API 5L X52":
        SMYS: 52000
        SMUS: 66000
        Reference: "API 5L specification"
      "API 5L X60":
        SMYS: 60000
        SMUS: 75000
        Reference: "API 5L specification"
      "API 5L X65":
        SMYS: 65000
        SMUS: 77000
        Reference: "API 5L specification"
      "API 5L X70":
        SMYS: 70000
        SMUS: 82000
        Reference: "API 5L specification"
      "API 5L X80":
        SMYS: 80000
        SMUS: 95000
        Reference: "API 5L specification"
      "ASTM A106 Grade A":
        SMYS: 30000
        SMUS: 48000
        Reference: "ASTM A106 specification"
      "ASTM A106 Grade B":
        SMYS: 35000
        SMUS: 60000
        Reference: "ASTM A106 specification"
      "ASTM A106 Grade C":
        SMYS: 40000
        SMUS: 70000
        Reference: "ASTM A106 specification"

# Manufacturing specifications
Manufacturing:
  Weld_Factor:
    Seamless: 1.0
    ERW: 0.8  # Electric resistance welded
    SAW: 1.0  # Submerged arc welded
    DSAW: 1.0  # Double submerged arc welded
  Quality_Classes:
    Standard: 1.0
    Sour_Service: 0.9  # For H2S environments
    High_Temperature: 0.95  # For elevated temperature service

# Environmental conditions
Environment:
  Seawater:
    density: 0.03703047  # lb/in3
    salinity: 3.5  # % by weight
    pH: 8.1
    temperature_seabed: 39  # deg F
    current_velocity: 1.0  # ft/s
  Soil_Properties:
    soil_type: "Clay"  # Options: Clay, Sand, Rock
    undrained_shear_strength: 500  # psf
    friction_angle: null  # degrees (for sand)
    unit_weight: 120  # pcf

# Analysis control parameters
Analysis:
  calculation_types:
    - "internal_pressure"  # Hoop stress check
    - "external_pressure"  # Collapse check
    - "longitudinal_stress"  # Longitudinal stress
    - "equivalent_stress"  # Combined stress (von Mises)
    - "fatigue"  # Fatigue analysis
    - "fracture"  # Fracture mechanics
  safety_factors:
    ultimate_limit_state: 1.0  # Additional safety factor
    serviceability_limit_state: 1.0
  convergence_criteria:
    tolerance: 1e-6
    max_iterations: 100

# Results configuration
Result:
  Outer_Pipe:
    # Results will be populated during analysis
    stress_summary: null
    usage_factors: null
    safety_margins: null
  Inner_Pipe:
    # For pipe-in-pipe systems
    stress_summary: null
    usage_factors: null

# Validation rules (for template validator)
validation_rules:
  required_fields:
    - "General.Water_Depth"
    - "Outer_Pipe.Geometry.Nominal_OD"
    - "Outer_Pipe.Geometry.Design_WT"
    - "Outer_Pipe.Material.Material_Grade"
    - "Design"
  value_ranges:
    water_depth: [0, 15000]  # Reasonable range in feet
    nominal_od: [2, 72]  # Pipeline OD range in inches
    design_wt: [0.1, 5.0]  # Wall thickness range in inches
    internal_pressure: [0, 15000]  # Pressure range in psi
    temperature: [-50, 500]  # Temperature range in deg F
  material_grades:
    - "API 5L X42"
    - "API 5L X52"
    - "API 5L X60"
    - "API 5L X65"
    - "API 5L X70"
    - "API 5L X80"
    - "ASTM A106 Grade A"
    - "ASTM A106 Grade B"
    - "ASTM A106 Grade C"

# Usage examples and notes
usage_notes: |
  This template provides comprehensive configuration for API STD 2RD pipeline design calculations.

  Key features:
  1. Multiple design codes support (API STD 2RD, ASME B31.4/B31.8, API RP 1111)
  2. Comprehensive material database with API 5L grades
  3. Environmental condition specifications
  4. Manufacturing quality factors
  5. Fatigue analysis parameters

  To use this template:
  1. Copy to your project directory
  2. Modify the parameters for your specific project
  3. Ensure all required fields are populated
  4. Run validation before analysis
  5. Review results and iterate as needed

  For multi-segment pipelines, create multiple design conditions or use
  the multi-component analysis approach with CSV input files.

references:
  - "API STD 2RD-2013, Design of Risers for Floating Production Systems (FPSs) and Tension-Leg Platforms (TLPs)"
  - "ASME B31.4-2019, Pipeline Transportation Systems for Liquids and Slurries"
  - "ASME B31.8-2020, Gas Transmission and Distribution Piping Systems"
  - "API RP 1111-2009, Design, Construction, Operation, and Maintenance of Offshore Hydrocarbon Pipelines"
  - "API RP 16Q-2017, Design, Selection, Operation and Maintenance of Marine Drilling Riser Systems"
  - "30 CFR Part 250, Oil and Gas and Sulphur Operations in the Outer Continental Shelf"