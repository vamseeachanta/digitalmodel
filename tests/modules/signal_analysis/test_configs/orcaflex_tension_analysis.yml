# OrcaFlex Tension Analysis Configuration
# This configuration file defines settings for rainflow and FFT analysis
# of tension data from OrcaFlex CSV output files

# Metadata
metadata:
  name: "OrcaFlex Tension Analysis"
  version: "1.0.0"
  description: "Rainflow and FFT analysis for structural tension data"
  author: "DigitalModel Team"
  created: "2024-08-21"

# Input Configuration
input:
  # Primary input file
  file_path: "tests/modules/signal-analysis/test_data/fat002_fsts_sample.csv"
  
  # Alternative for full file (if available)
  # file_path: "D:/1522/ctr7/orcaflex/rev_a08/output/csv/07c_fatigue/fat002_fsts_l015_mwl_wave02_Strut1.csv"
  
  # Column mappings
  columns:
    time: "time"  # Time column name
    tensions:
      - name: "Tension (Jacket End)"
        units: "kN"
        location: "jacket"
      - name: "Tension (Vessel End)" 
        units: "kN"
        location: "vessel"
  
  # Data preprocessing
  preprocessing:
    remove_mean: false  # Keep mean for fatigue analysis
    detrend: false      # Keep trend for realistic loading
    filter_outliers: true
    outlier_threshold: 5  # Standard deviations
    interpolate_gaps: true
    max_gap_size: 10  # Maximum gap to interpolate (samples)

# Analysis Configuration
analysis:
  # Sampling rate determination
  sampling:
    auto_detect: true  # Automatically detect from time column
    default_rate: 10.0  # Hz - fallback if auto-detect fails
    
  # Rainflow counting settings
  rainflow:
    method: "astm"  # ASTM E1049-85 standard
    extract_info: true  # Extract cycle position info
    bin_count: 50  # Number of bins for histogram
    
    # Fatigue parameters (optional)
    fatigue:
      enable: true
      sn_curve: "DNV-D"  # S-N curve standard
      safety_factor: 2.0
      design_life_years: 25
      
  # FFT analysis settings
  fft:
    # Window-averaged FFT parameters
    window_size: 4096  # Samples per window
    overlap: 0.5  # 50% overlap between windows
    window_function: "hanning"  # Window type
    
    # Frequency analysis
    frequency_limit: 10.0  # Hz - maximum frequency to analyze
    frequency_resolution: 0.01  # Hz - desired resolution
    
    # Spectral methods
    methods:
      - "standard_fft"  # Basic FFT
      - "welch_psd"     # Welch's power spectral density
      - "window_averaged"  # Window-averaged FFT
    
    # Peak detection
    peak_detection:
      enable: true
      n_peaks: 10  # Number of peaks to identify
      min_height: 0.01  # Minimum peak height (normalized)
      min_distance: 0.1  # Minimum distance between peaks (Hz)

# Output Configuration
output:
  # Output directory
  directory: "output/orcaflex_tension_analysis"
  
  # Create subdirectories by timestamp
  use_timestamp: true
  timestamp_format: "%Y%m%d_%H%M%S"
  
  # File naming
  prefix: "tension"
  suffix: ""
  
  # Output formats
  formats:
    csv: true
    json: true
    excel: false
    mat: false  # MATLAB format
  
  # Rainflow outputs
  rainflow:
    cycles_table: true  # Full cycle list
    histogram_data: true  # Binned histogram
    statistics: true  # Summary statistics
    damage_report: true  # Fatigue damage if enabled
    
    # Plots
    plots:
      histogram: true
      mean_range_scatter: true
      cumulative_damage: true
      cycle_sequence: false  # Can be large
  
  # FFT outputs  
  fft:
    spectrum_data: true  # Frequency vs amplitude
    psd_data: true  # Power spectral density
    peak_frequencies: true  # Dominant frequencies
    
    # Plots
    plots:
      spectrum: true
      psd: true
      spectrogram: true
      phase: false
      
  # Time series outputs
  timeseries:
    processed_signal: true  # After preprocessing
    statistics: true  # Statistical summary
    
    # Plots
    plots:
      time_history: true
      statistical_summary: true
      
  # Report generation
  report:
    generate: true
    format: "html"  # html, pdf, or markdown
    include_plots: true
    include_tables: true
    include_config: true

# Processing Configuration
processing:
  # Parallel processing
  parallel:
    enable: true
    max_workers: 4
    
  # Memory management
  memory:
    chunk_size: 10000  # Process in chunks if file is large
    use_memory_map: false  # Memory-mapped file reading
    
  # Error handling
  errors:
    continue_on_error: false
    save_partial_results: true
    detailed_logging: true
    
  # Progress reporting
  progress:
    show_progress: true
    update_frequency: 1.0  # seconds

# Batch Processing Configuration
batch:
  enable: false
  input_pattern: "*.csv"
  input_directory: "D:/1522/ctr7/orcaflex/rev_a08/output/csv/07c_fatigue"
  recursive: false
  
  # File filtering
  filters:
    min_size: 1000  # bytes
    max_size: 100000000  # 100 MB
    include_pattern: "fat*.csv"
    exclude_pattern: "*_processed.csv"
    
  # Batch output
  aggregate_results: true
  comparison_report: true

# Validation Configuration
validation:
  # Input validation
  check_columns: true
  check_units: true
  check_continuity: true
  
  # Output validation
  verify_outputs: true
  check_ranges: true
  
  # Known values for validation (optional)
  expected_values:
    max_tension_jacket: 5000.0  # kN
    max_tension_vessel: 4500.0  # kN
    dominant_frequency: 0.1  # Hz (wave frequency)

# Logging Configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "tension_analysis.log"
  console: true
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  
# Environment Configuration
environment:
  # Paths
  data_root: "D:/1522/ctr7/orcaflex"
  output_root: "D:/github/digitalmodel/output"
  
  # System
  use_gpu: false  # GPU acceleration if available
  cache_results: true
  cache_directory: ".cache/tension_analysis"