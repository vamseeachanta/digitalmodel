# Cross-Repository Change Propagation Rules
# Defines which files propagate to which repositories and how

propagation_rules:
  # Global propagation - applies to ALL active repositories
  global:
    - .claude/settings.json  # Hook configurations
    - .agent-os/standards/*.md  # All standards files

  # Conditional propagation - based on repository tags
  conditional:
    # Marine engineering skills
    - path: .claude/skills/orcaflex-*
      condition: marine
      description: "OrcaFlex-related skills for marine engineering repos"

    - path: .claude/skills/aqwa-*
      condition: marine
      description: "AQWA hydrodynamic analysis skills"

    - path: .claude/skills/orcawave-*
      condition: marine
      description: "OrcaWave analysis skills"

    - path: .claude/skills/mooring-*
      condition: marine
      description: "Mooring system design skills"

    - path: .claude/skills/catenary-*
      condition: marine
      description: "Catenary riser analysis skills"

    - path: .claude/skills/hydrodynamics
      condition: marine
      description: "Hydrodynamic coefficient management"

    # Engineering analysis skills
    - path: .claude/skills/fatigue-*
      condition: engineering
      description: "Fatigue analysis skills"

    - path: .claude/skills/structural-*
      condition: engineering
      description: "Structural analysis skills"

    - path: .claude/skills/viv-*
      condition: engineering
      description: "VIV analysis skills"

    - path: .claude/skills/cathodic-*
      condition: engineering
      description: "Cathodic protection skills"

    # CAD and meshing
    - path: .claude/skills/freecad-*
      condition: cad
      description: "FreeCAD automation skills"

    - path: .claude/skills/cad-*
      condition: cad
      description: "CAD engineering skills"

    - path: .claude/skills/gmsh-*
      condition: meshing
      description: "GMSH meshing skills"

    # Signal processing
    - path: .claude/skills/signal-*
      condition: signal-processing
      description: "Signal analysis skills"

  # Template merge configuration for CLAUDE.md
  template_merge:
    .claude/CLAUDE.md:
      enabled: true
      managed_sections:
        - "## Interactive Engagement (MANDATORY)"
        - "## üö® CRITICAL: CONCURRENT EXECUTION & FILE MANAGEMENT"
        - "## üìÅ File Organization Rules"
        - "## üéØ Claude Code vs MCP Tools"
        - "## üìã Agent Coordination Protocol"
        - "## üéØ Concurrent Execution Examples"
      preserve_sections:
        - "## Project Overview"
        - "## Codex Skills Link"
        - "## Custom Rules"
        - "## Project-Specific Configuration"
      merge_strategy: section_markers
      markers:
        managed_start: "# WORKSPACE-MANAGED"
        managed_end: "# END WORKSPACE-MANAGED"
        repo_specific_start: "# REPO-SPECIFIC"
        repo_specific_end: "# END REPO-SPECIFIC"

# Repository filtering and discovery
repository_discovery:
  # Base directory for all repositories
  base_path: D:/workspace-hub

  # Repository tags for conditional propagation
  # Format: repo_name: [tags]
  repository_tags:
    digitalmodel: [marine, engineering, cad, meshing, signal-processing, active]
    # Add other repositories here as they are configured

  # Exclude patterns
  exclude:
    - "*/node_modules/*"
    - "*/.git/*"
    - "*/venv/*"
    - "*/.venv/*"
    - "*/__pycache__/*"
    - "*/dist/*"
    - "*/build/*"

# Safety and backup configuration
safety:
  # Create backup branch before propagation
  create_backup: true
  backup_branch_prefix: "propagation"

  # Require approval after dry-run
  require_approval: true

  # Create propagation branch for changes
  create_branch: true
  branch_prefix: "propagation"
  branch_format: "{prefix}/{date}"  # e.g., propagation/20260107

  # Conflict handling
  on_conflict: skip  # skip, overwrite, merge
  log_conflicts: true

  # Commit message template
  commit_message_template: |
    chore(propagation): Update from workspace-hub

    Propagated changes:
    {file_list}

    Source: {source_repo}
    Propagation ID: {propagation_id}
    Date: {date}

# Reporting configuration
reporting:
  # Generate detailed report
  generate_report: true
  report_path: reports/propagation
  report_format: markdown  # markdown, json, html

  # Include in report
  include:
    - success_list
    - skip_list
    - conflict_list
    - file_changes
    - diff_summary
    - commit_hashes

  # Verbosity
  verbose: true
