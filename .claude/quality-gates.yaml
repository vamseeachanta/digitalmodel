# Quality Gates Configuration
# Linear execution order: tests → coverage → quality → security

gates:
  # Gate 1: Tests must pass first
  tests:
    enabled: true
    order: 1
    description: "All tests must pass"
    command: "pytest --maxfail=1 -x"
    failure_action: "block"
    warning_action: "report"

  # Gate 2: Code coverage check
  coverage:
    enabled: true
    order: 2
    description: "Test coverage requirements"
    depends_on: ["tests"]
    thresholds:
      failure: 60.0  # Below 60% = failure
      warning: 80.0  # 60-80% = warning, ≥80% = pass
    report_format: "json"
    output_file: "coverage.json"
    failure_action: "block"
    warning_action: "warn"

  # Gate 3: Code quality (complexity + linting)
  quality:
    enabled: true
    order: 3
    description: "Code quality and complexity checks"
    depends_on: ["tests", "coverage"]
    tools:
      ruff:
        enabled: true
        complexity_threshold:
          warning: 10  # Cyclomatic complexity ≥10 = warning
          failure: 15  # Cyclomatic complexity ≥15 = failure
        command: "ruff check"
        config_file: "pyproject.toml"
    failure_action: "block"
    warning_action: "warn"

  # Gate 4: Security scanning
  security:
    enabled: true
    order: 4
    description: "Security vulnerability scanning"
    depends_on: ["tests", "coverage", "quality"]
    tools:
      bandit:
        enabled: true
        command: "bandit -r src/ -f json -o reports/bandit_report.json"
        severity_threshold:
          high: "failure"    # High severity = failure
          medium: "warning"  # Medium severity = warning
          low: "report"      # Low severity = report only
        confidence_threshold: "medium"
    failure_action: "block"
    warning_action: "warn"

  # Gate 5: Documentation coverage
  documentation:
    enabled: true
    order: 5
    description: "Documentation coverage check"
    depends_on: []  # Can run independently
    threshold: 75.0  # 75% of functions with docstrings
    scan_paths:
      - "src/digitalmodel"
    exclude_paths:
      - "*/tests/*"
      - "*/__pycache__/*"
      - "*/migrations/*"
    failure_action: "warn"   # Documentation is warning only
    warning_action: "report"

# Global settings
settings:
  # Execution mode
  execution_mode: "linear"  # Linear execution (not parallel)

  # CLI behavior
  cli:
    strict_mode: false  # Default to soft warnings, --strict flag for enforcement
    verbose: true
    show_details: true
    color_output: true

  # Pre-commit behavior
  pre_commit:
    enabled: true
    strict_mode: true  # Hard block in pre-commit
    fail_fast: true    # Stop on first failure

  # CI/CD behavior
  ci_cd:
    enabled: true
    strict_mode: true
    export_results: true
    result_format: "json"
    result_file: "reports/quality_gates_results.json"

  # Reporting
  reporting:
    console:
      enabled: true
      format: "detailed"  # detailed | summary | minimal
    json:
      enabled: true
      output_file: "reports/quality_gates_results.json"
    html:
      enabled: false  # Future: Interactive dashboard with Plotly
      output_file: "reports/quality_gates_report.html"

  # Paths
  paths:
    source_root: "src"
    test_root: "tests"
    reports_dir: "reports"
    cache_dir: ".quality-gates-cache"

  # Performance
  performance:
    cache_enabled: true
    cache_duration: 3600  # 1 hour in seconds
    parallel_execution: false  # Keep simple for now
    timeout: 300  # 5 minutes max per gate
