# ═══════════════════════════════════════════════════════════════════════════════
# CALM BUOY PROJECT CONFIGURATION TEMPLATE
# ═══════════════════════════════════════════════════════════════════════════════
# ABOUTME: Project-level YAML template for CALM Buoy offshore mooring systems
# ABOUTME: Generates OrcaFlex models, FreeCAD drawings, Blender visualizations
#
# WORKFLOW:
#   1. Copy this template to projects/<your_project>/
#   2. Fill in human_input section with project-specific values
#   3. Run: python scripts/generate_calm_buoy_project.py --config project_config.yml
#   4. Review ai_generated section (auto-populated)
#   5. Generate OrcaFlex files: python scripts/generate_calm_buoy_project.py --generate
#   6. Validate: python run_validation.py --project projects/<your_project>
# ═══════════════════════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 1: HUMAN INPUT (Edit these values)
# ═══════════════════════════════════════════════════════════════════════════════
human_input:

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.1 PROJECT METADATA
  # ─────────────────────────────────────────────────────────────────────────────
  project:
    name: "North Sea CALM Buoy Project"
    code: "NSE_CALM_2025"
    client: "North Sea Energy Ltd"
    operator: "NuStar Energy"
    location: "North Sea - UK Sector"
    latitude: 57.5                          # Decimal degrees
    longitude: 1.2                          # Decimal degrees
    created_date: "2025-01-15"
    engineer: "John Smith"
    reviewer: "Jane Doe"
    version: "1.0"
    description: |
      CALM buoy mooring system for VLCC offloading operations
      in North Sea conditions. Design for 100-year return period.

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.2 DESIGN STANDARDS & CODES
  # ─────────────────────────────────────────────────────────────────────────────
  standards:
    primary_code: "ISO 19901-1"             # ISO Petroleum and natural gas industries
    mooring_standard: "API RP 2SK"          # API mooring design standard
    buoy_standard: "DNVGL-OS-E403"          # DNV offshore standard for mooring
    classification_society: "ABS"            # American Bureau of Shipping
    national_regulations:
      - "UK HSE Offshore Installation Regulations"
      - "IMCA M103 - Guidelines for Moorings"
    industry_guidelines:
      - "OCIMF SMOG - Single Point Mooring Operations Guide"
      - "OCIMF MEG4 - Mooring Equipment Guidelines"

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.3 SITE CONDITIONS
  # ─────────────────────────────────────────────────────────────────────────────
  site:
    water_depth: 120                        # meters
    seabed_type: "soft clay"                # Options: soft clay, sand, rock
    seabed_slope: 2.0                       # degrees
    seabed_friction_coefficient: 0.5        # Lateral friction

    # Metocean conditions (can reference CSV or specify directly)
    metocean_source: "data/results/calm_buoy/project_specific/environmental_conditions.csv"

    # Or specify directly (overrides CSV):
    metocean_override:
      operating_conditions:
        hs_max: 2.5                         # Significant wave height (m)
        tp_max: 8.0                         # Peak period (s)
        wind_speed_max: 15                  # Wind speed (m/s)
        current_speed_surface: 1.2          # Surface current (m/s)
        current_speed_seabed: 0.3           # Seabed current (m/s)

      extreme_conditions:                   # 100-year return period
        hs_100yr: 8.5                       # Significant wave height (m)
        tp_100yr: 14.0                      # Peak period (s)
        wind_speed_100yr: 35                # Wind speed (m/s)
        current_speed_surface_100yr: 2.0    # Surface current (m/s)

    # Tidal range
    tidal_range: 4.5                        # meters (LAT to HAT)

    # Marine growth
    marine_growth_thickness: 0.05           # meters (chain diameter increase)

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.4 BUOY SPECIFICATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  buoy:
    # Basic geometry
    type: "turret_calm"                     # Options: turret_calm, articulated_tower
    outer_diameter: 12.0                    # meters
    draft: 10.0                             # meters
    freeboard: 3.0                          # meters
    skirt_diameter: 11.0                    # meters

    # Mass properties
    displacement: 9500                      # tonnes
    mass_dry: 8500                          # tonnes (empty)
    mass_operating: 9200                    # tonnes (ballasted)
    centre_of_gravity: [0, 0, -2.0]        # [x, y, z] from waterline (m)

    # Moments of inertia (tonne·m²)
    inertia_roll: 260000                    # Ixx (about longitudinal axis)
    inertia_pitch: 6000000                  # Iyy (about transverse axis)
    inertia_yaw: 6000000                    # Izz (about vertical axis)

    # Hydrodynamics source
    hydrodynamic_database: "data/processed/calm_buoy/mature_design/hydrodynamic_coefficients.csv"
    rao_source: "specs/modules/orcaflex/modular-input-file/output/_04_vessel_types.yml"

    # Material
    material: "Steel"
    coating: "Epoxy + Marine Grade Paint"
    design_life: 25                         # years

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.5 MOORING SYSTEM
  # ─────────────────────────────────────────────────────────────────────────────
  mooring:
    # Configuration
    pattern: "radial_symmetric"             # Options: radial_symmetric, asymmetric, turret
    number_of_lines: 6                      # Typically 6, 8, or 12
    azimuth_spacing: 60                     # degrees (360/number_of_lines)

    # Mooring line composition (from fairlead to anchor)
    line_segments:
      - name: "top_chain"
        type: "studless_chain"
        grade: "R4"
        nominal_diameter: 76                # mm (3.0 inches)
        length: 150                         # meters
        mbl: 7300                           # Minimum Breaking Load (kN)
        mass_per_meter: 88.3                # kg/m
        ea: 407000                          # Axial stiffness (kN)

      - name: "bottom_chain"
        type: "studless_chain"
        grade: "R4"
        nominal_diameter: 76                # mm
        length: 200                         # meters
        mbl: 7300                           # kN
        mass_per_meter: 88.3                # kg/m
        ea: 407000                          # kN

    # Mooring components
    fairlead_height: -1.5                   # meters below waterline
    anchor_type: "drag_embedment"           # Options: drag_embedment, pile, suction
    anchor_holding_capacity: 2500           # kN (per anchor)

    # Design factors
    safety_factor_intact: 1.8               # All lines intact
    safety_factor_damaged: 1.25             # One line damaged
    pretension: 500                         # kN (initial pretension per line)

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.6 OFFLOADING SYSTEM
  # ─────────────────────────────────────────────────────────────────────────────
  offloading:
    # Vessel characteristics
    tanker_type: "VLCC"                     # Very Large Crude Carrier
    tanker_dwt: 300000                      # Deadweight tonnage
    tanker_loa: 330                         # Length overall (m)
    tanker_beam: 60                         # Beam (m)
    tanker_draft_laden: 22                  # Draft when loaded (m)

    # Hose configuration
    hose_type: "floating_hose_string"
    hose_diameter: 16                       # inches
    hose_length: 120                        # meters (buoy to tanker)
    hose_segments: 3                        # Number of hose sections
    hose_mbl: 150                           # kN (hose strength)

    # Hawser (mooring tanker to buoy)
    hawser_type: "nylon_rope"
    hawser_diameter: 76                     # mm
    hawser_length: 90                       # meters
    hawser_mbl: 1800                        # kN

    # Transfer capacity
    transfer_rate: 100000                   # barrels per hour
    product_density: 0.85                   # tonnes/m³ (crude oil)

  # ─────────────────────────────────────────────────────────────────────────────
  # 1.7 ANALYSIS SETTINGS
  # ─────────────────────────────────────────────────────────────────────────────
  analysis:
    # Fidelity levels
    run_preliminary: true                   # Quick screening with standard model
    run_detailed: true                      # Full analysis with discretised model
    run_sensitivity: false                  # Parametric variations

    # Load cases
    load_cases:
      - name: "operating_0deg"
        condition: "operating"
        wave_direction: 0                   # degrees
        current_direction: 0
        wind_direction: 0

      - name: "operating_45deg"
        condition: "operating"
        wave_direction: 45
        current_direction: 30
        wind_direction: 15

      - name: "extreme_0deg"
        condition: "extreme"
        wave_direction: 0
        current_direction: 0
        wind_direction: 0

      - name: "extreme_180deg"
        condition: "extreme"
        wave_direction: 180
        current_direction: 120
        wind_direction: 165

    # Simulation parameters
    simulation_duration: 3600               # seconds (1 hour)
    time_step: 0.1                          # seconds
    ramp_time: 100                          # seconds (wave ramp-up)

    # Output requests
    output_mooring_tension: true
    output_buoy_motions: true
    output_hose_curvature: true
    output_clearances: true
    output_statistics: true                 # Max, min, mean, std dev


# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 2: AI GENERATED / VALIDATED (Auto-populated by generation script)
# ═══════════════════════════════════════════════════════════════════════════════
ai_generated:

  # ─────────────────────────────────────────────────────────────────────────────
  # 2.1 VALIDATION METADATA
  # ─────────────────────────────────────────────────────────────────────────────
  validation:
    validated_by_ai: false                  # Set to true after AI validation
    validation_date: null                   # ISO 8601 timestamp
    validation_version: "1.0"
    confidence_score: null                  # 0.0 to 1.0

    # Validation checks performed
    checks:
      geometry_within_ranges: null          # Pass/Fail
      metocean_realistic: null              # Pass/Fail
      mooring_capacity_adequate: null       # Pass/Fail
      safety_factors_met: null              # Pass/Fail
      orcaflex_syntax_valid: null           # Pass/Fail

  # ─────────────────────────────────────────────────────────────────────────────
  # 2.2 DERIVED PARAMETERS
  # ─────────────────────────────────────────────────────────────────────────────
  derived:
    # Mooring system
    mooring_footprint_radius: null          # meters (calculated from geometry)
    total_mooring_mass: null                # tonnes (sum of all chains)
    mooring_stiffness_surge: null           # kN/m (at mean position)
    mooring_stiffness_sway: null            # kN/m
    watch_circle_radius: null               # meters (max excursion)

    # Buoy
    buoy_natural_periods:
      surge: null                           # seconds
      heave: null                           # seconds
      pitch: null                           # seconds

    # Load distribution
    max_line_tension_operating: null        # kN (most loaded line)
    max_line_tension_extreme: null          # kN
    utilization_ratio_intact: null          # Tension / MBL
    utilization_ratio_damaged: null         # With one line failed

  # ─────────────────────────────────────────────────────────────────────────────
  # 2.3 RECOMMENDATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  recommendations:
    warnings: []                            # List of warning messages
    suggestions: []                         # List of improvement suggestions

    # Example warnings (populated by AI):
    # - "Water depth 120m exceeds typical CALM buoy range (50-100m). Consider suction anchors."
    # - "Safety factor 1.8 is below API RP 2SK recommended 2.0 for permanent moorings."

    # Example suggestions:
    # - "Consider increasing chain diameter from 76mm to 84mm for 100-year extreme conditions."
    # - "Add intermediate buoy at 100m from fairlead to reduce mooring line weight."

  # ─────────────────────────────────────────────────────────────────────────────
  # 2.4 REFERENCE DATA LINKS
  # ─────────────────────────────────────────────────────────────────────────────
  data_sources:
    hull_geometry_ranges: "data/raw/calm_buoy/generic_range/hull_geometry_ranges.csv"
    metocean_design_ranges: "data/raw/calm_buoy/generic_range/metocean_design_ranges.csv"
    mooring_capacity_ranges: "data/raw/calm_buoy/generic_range/mooring_capacity_ranges.csv"

    hydrodynamic_coefficients: "data/processed/calm_buoy/mature_design/hydrodynamic_coefficients.csv"
    structural_components: "data/processed/calm_buoy/mature_design/structural_components.csv"

    project_environmental_conditions: "data/results/calm_buoy/project_specific/environmental_conditions.csv"
    project_mooring_properties: "data/results/calm_buoy/project_specific/mooring_line_properties.csv"
    project_offloading_config: "data/results/calm_buoy/project_specific/offloading_configuration.csv"


# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 3: GENERATION CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
generation:

  # ─────────────────────────────────────────────────────────────────────────────
  # 3.1 ORCAFLEX MODEL GENERATION
  # ─────────────────────────────────────────────────────────────────────────────
  orcaflex:
    # Template selection
    templates:
      preliminary:
        base: "specs/modules/orcaflex/modular-input-file/output/calm_buoy_base.yml"
        description: "Standard model with lumped buoy representation"
        modules: 16

      detailed:
        base: "specs/modules/orcaflex/modular-input-file/output/discretised_calm_buoy_base.yml"
        description: "Discretised model with detailed buoy geometry"
        modules: 17

    # Module override strategy (hybrid approach)
    overrides:
      environment:
        template: "jonswap_default"         # Use JONSWAP wave template
        customize:
          wave_hs: "human_input.site.metocean_override.operating_conditions.hs_max"
          wave_tp: "human_input.site.metocean_override.operating_conditions.tp_max"
          current_speed: "human_input.site.metocean_override.operating_conditions.current_speed_surface"
          wind_speed: "human_input.site.metocean_override.operating_conditions.wind_speed_max"

      buoy:
        template: "vessel_type_default"
        customize:
          mass: "human_input.buoy.mass_operating"
          draft: "human_input.buoy.draft"
          cog: "human_input.buoy.centre_of_gravity"

      mooring:
        template: "radial_6_lines"
        customize:
          number_of_lines: "human_input.mooring.number_of_lines"
          chain_diameter: "human_input.mooring.line_segments[0].nominal_diameter"
          top_chain_length: "human_input.mooring.line_segments[0].length"
          bottom_chain_length: "human_input.mooring.line_segments[1].length"

  # ─────────────────────────────────────────────────────────────────────────────
  # 3.2 OUTPUT STRUCTURE
  # ─────────────────────────────────────────────────────────────────────────────
  output:
    project_root: "projects/{project_code}"  # Auto-replaced with project code

    structure:
      orcaflex:
        path: "orcaflex"
        files:
          - "{project_code}_calm_buoy_base.yml"
          - "modules/*.yml"

      freecad:
        path: "freecad"
        files:
          - "buoy_geometry.FCStd"
          - "mooring_layout.FCStd"

      blender:
        path: "blender"
        files:
          - "visualization.blend"
          - "renders/*.png"

      reports:
        path: "reports"
        files:
          - "validation_report.html"
          - "analysis_summary.pdf"

      data:
        path: "data"
        files:
          - "project_metocean.csv"
          - "mooring_properties.csv"

  # ─────────────────────────────────────────────────────────────────────────────
  # 3.3 VALIDATION INTEGRATION
  # ─────────────────────────────────────────────────────────────────────────────
  validation:
    run_after_generation: true              # Auto-validate generated files
    levels:
      - 1                                   # YAML syntax
      - 3                                   # Physical consistency (skip level 2 if no OrcaFlex)

    tolerance_percent: 10.0                 # Physical validation tolerance
    fail_on_critical: true                  # Stop if critical issues found
    warn_on_out_of_range: true              # Warn for out-of-range parameters


# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 4: MULTI-FIDELITY ANALYSIS CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
multi_fidelity:

  enabled: false                            # Enable multi-fidelity analysis

  analyses:
    # ───────────────────────────────────────────────────────────────────────────
    # Quick screening analysis
    # ───────────────────────────────────────────────────────────────────────────
    - name: "preliminary_screening"
      fidelity: "low"
      orcaflex_template: "calm_buoy_base.yml"
      description: "Fast screening with coarse mesh and simplified hydrodynamics"

      settings:
        simulation_duration: 1800           # 30 minutes
        time_step: 0.2                      # Larger time step
        mesh_density: "coarse"
        wave_components: 50                 # Fewer wave components

      load_cases:
        - "operating_0deg"
        - "extreme_0deg"

    # ───────────────────────────────────────────────────────────────────────────
    # Detailed design analysis
    # ───────────────────────────────────────────────────────────────────────────
    - name: "detailed_design"
      fidelity: "high"
      orcaflex_template: "discretised_calm_buoy_base.yml"
      description: "Full analysis with discretised buoy and fine mesh"

      settings:
        simulation_duration: 3600           # 1 hour
        time_step: 0.05                     # Fine time step
        mesh_density: "fine"
        wave_components: 200                # Many wave components

      load_cases:
        - "operating_0deg"
        - "operating_45deg"
        - "extreme_0deg"
        - "extreme_180deg"

    # ───────────────────────────────────────────────────────────────────────────
    # Parametric sensitivity study
    # ───────────────────────────────────────────────────────────────────────────
    - name: "sensitivity_study"
      fidelity: "medium"
      orcaflex_template: "calm_buoy_base.yml"
      description: "Parametric variations around design point"

      parameter_variations:
        - parameter: "wave_hs"
          values: [1.5, 2.0, 2.5, 3.0]
          units: "m"

        - parameter: "current_speed"
          values: [0.5, 1.0, 1.5, 2.0]
          units: "m/s"

        - parameter: "pretension"
          values: [300, 500, 700]
          units: "kN"

      load_cases:
        - "operating_0deg"


# ═══════════════════════════════════════════════════════════════════════════════
# END OF CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
