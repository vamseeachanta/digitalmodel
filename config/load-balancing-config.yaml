# ABOUTME: Load balancing configuration for work-stealing scheduler
# Defines thresholds, strategies, and policies for task redistribution

load_balancing:
  # Strategy: hybrid (pull-based with push intervention)
  strategy: "hybrid"

  # Agent busyness thresholds (based on queue_length)
  thresholds:
    busy_threshold: 5        # Agent considered busy if queue_length > 5
    idle_threshold: 2        # Agent considered idle if queue_length < 2
    rebalance_interval_sec: 30  # Scheduler intervention interval
    severe_imbalance_ratio: 3.0  # Push intervention if max/min queue ratio > 3.0

  # Work stealing policies
  work_stealing:
    max_steal_per_cycle: 3      # Maximum tasks to steal per rebalancing cycle
    prefer_recent_tasks: true    # Steal newest tasks first (LIFO from queue)
    allow_task_migration: false  # Only steal queued tasks, not in-progress
    min_tasks_to_steal: 1        # Minimum tasks before attempting steal

  # Capability matching strategies
  capabilities:
    matching_strategy: "best_fit"  # exact (critical), best_fit (normal), fallback
    consider_history: true         # Use agent performance history for selection
    fallback_enabled: true         # Allow fallback for normal priority tasks
    history_weight: 0.3            # Weight of performance history (0-1)

  # Task priority handling
  priority:
    high_priority_threshold: 4    # Tasks with priority >= 4 are high-priority
    preserve_high_priority: true  # High-priority tasks not interrupted
    priority_stealing_order: true # Steal low-priority tasks first

  # Metrics collection
  metrics:
    track_migrations: true                    # Track all work stealing events
    track_utilization: true                   # Track agent queue depths over time
    track_wait_times: true                    # Track task wait times
    histogram_buckets: [0.1, 0.5, 1.0, 5.0, 10.0, 30.0]  # Time buckets (seconds)
    utilization_sample_interval_sec: 5        # How often to sample utilization

  # Performance tuning
  performance:
    max_concurrent_steals: 5      # Maximum concurrent steal operations
    steal_batch_size: 1           # Tasks to steal per operation
    cache_capability_matches: true # Cache capability matching results
    cache_ttl_sec: 300            # Cache TTL for capability matches
