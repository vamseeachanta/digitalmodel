# OrcaWave Diffraction Analysis Specification - Sea Cypress Vessel

## ⚠️ CRITICAL: Specialized Knowledge Requirements
**IMPORTANT**: This specification involves specialized marine engineering domains. See `SPECIALIZED_KNOWLEDGE_REQUIREMENTS.md` for areas requiring expert input. AI agents MUST escalate to users when encountering:
- Geometry generation (GDF format)
- Mesh quality criteria
- Hydrodynamic parameters
- Morison coefficients

## Overview
Implementation of hydrodynamic diffraction analysis for Sea Cypress vessel using OrcaWave with automated geometry processing and batch execution. Results will be formatted for subsequent OrcaFlex integration (see separate specification).

## Business Requirements
- Perform diffraction analysis on Sea Cypress vessel geometry
- Automate workflow from geometry import to results export
- Support multiple geometry formats (STL, OBJ)
- Generate hydrodynamic database in OrcaWave-native formats
- Export results in formats suitable for OrcaFlex (integration handled separately)

## Technical Requirements

### Geometry Processing
**Input Geometries:**
- Location: `J:\B1512 Nork & Mendez (legal) Hyundai Peacepia vs Sea Cypress sinking\ACMA Work\Sea Cypress Tug Data\Rhino Model Sea Cypress`
- Files:
  - `Sea Cypress_0.25 Mesh_Ascii.stl` - ASCII STL format
  - `Sea Cypress_0.25 Mesh_Binary.obj` - Wavefront OBJ format
  - `Sea Cypress_0.25 Mesh_Binary.stl` - Binary STL format

**Geometry Format Selection Criteria:**
1. **Binary STL (Recommended)**
   - Most efficient for OrcaWave import
   - Compact file size
   - Direct support in OrcaWave GDF converter
   - Preserves mesh topology accurately

2. **ASCII STL (Alternative)**
   - Human-readable for verification
   - Larger file size
   - Compatible with OrcaWave

3. **OBJ Format (Not Recommended)**
   - Requires conversion
   - May lose mesh properties
   - Additional processing overhead

### OrcaWave Configuration

#### Input YAML Structure
```yaml
analysis:
  name: "Sea_Cypress_Diffraction"
  type: "diffraction"
  vessel:
    name: "Sea Cypress"
    geometry: "Sea Cypress_0.25 Mesh_Binary.stl"
    
environment:
  water_depth: 100.0  # meters
  density: 1025.0     # kg/m³
  gravity: 9.81       # m/s²
  
mesh_settings:
  panel_size: 0.25    # meters
  convergence: true
  refinement_zones: []
  
frequency_range:
  start: 0.01        # rad/s
  end: 3.0           # rad/s
  steps: 100
  
wave_directions:
  start: 0           # degrees
  end: 180           # degrees
  increment: 15      # degrees
  
outputs:
  formats:
    - "spreadsheet"  # Excel/CSV
    - "orcaflex"     # .yml for OrcaFlex
    - "database"     # Hydrodynamic database
  directory: "./results/"
  
computation:
  parallel_workers: 4
  solver: "direct"
  memory_limit: "16GB"
```

### Batch Processing Configuration

#### Batch Execution Script
```batch
@echo off
REM Sea Cypress Diffraction Analysis Batch Runner
REM Generated by OrcaWave Agent

SET ORCAWAVE_PATH="C:\Program Files\Orcina\OrcaWave\bin\orcawave.exe"
SET CONFIG_FILE="sea_cypress_diffraction.yml"
SET LOG_FILE="analysis_log_%date:~-4,4%%date:~-10,2%%date:~-7,2%.txt"

echo Starting OrcaWave Diffraction Analysis...
echo Configuration: %CONFIG_FILE%
echo Log file: %LOG_FILE%

REM Run OrcaWave analysis
%ORCAWAVE_PATH% -config %CONFIG_FILE% -batch -log %LOG_FILE%

if %ERRORLEVEL% NEQ 0 (
    echo ERROR: OrcaWave analysis failed with code %ERRORLEVEL%
    exit /b %ERRORLEVEL%
)

echo Analysis completed successfully
echo Processing results...

REM Convert results to OrcaFlex format
python convert_to_orcaflex.py --input ./results/ --output ./orcaflex/

echo Batch processing complete
```

### Results Export Formats

#### Standard OrcaWave Outputs
1. **Hydrodynamic Coefficients**
   - Added mass matrices (.csv)
   - Radiation damping coefficients (.csv)
   - Wave excitation forces (.csv)
   - Phase information (.csv)

2. **Database Formats**
   - OrcaWave native database (.owd)
   - WAMIT-compatible format (.out)
   - Excel workbook with all results (.xlsx)

3. **OrcaFlex-Ready Format**
   - Structured YAML for direct import
   - Frequency-dependent coefficients
   - Complete metadata for traceability

**Note**: OrcaFlex integration is handled in a separate specification to maintain modularity and allow for independent execution of diffraction analysis.

## System Architecture

### Component Overview
1. **Geometry Processor** - Validates and converts mesh formats
2. **OrcaWave Engine** - Performs diffraction analysis
3. **Results Processor** - Formats output data
4. **Export Manager** - Generates multiple output formats

### Data Flow
```
Geometry Files → Validation → OrcaWave Analysis → Results Processing → Export Formats
     ↓               ↓              ↓                    ↓                   ↓
   (STL/OBJ)    (Mesh Check)   (Diffraction)      (Processing)      (CSV/XLSX/YML)
```

## Agent Delegation Requirements

### Specialized Agents Needed:
1. **Geometry Agent** (TO BE CREATED)
   - GDF file generation
   - Mesh conversion (triangular to quadrilateral)
   - Panel quality validation
   
2. **Hydrodynamics Agent** (OPTIONAL)
   - Parameter selection
   - Results validation
   - Physical property verification

### Escalation Triggers:
- ANY geometry generation request → User input required
- Mesh quality issues → Request domain expert
- Missing vessel properties → Request naval architect data
- Convergence failures → Numerical specialist needed

## Implementation Approach

### Phase 1: Geometry Preparation
**⚠️ REQUIRES SPECIALIZED KNOWLEDGE - See SPECIALIZED_KNOWLEDGE_REQUIREMENTS.md**
- Validate all three geometry files
- Select optimal format (Binary STL)
- Perform mesh quality checks
- Generate GDF file for OrcaWave

### Phase 2: Analysis Configuration
- Create YAML configuration file
- Set environmental parameters
- Define frequency and direction ranges
- Configure solver settings

### Phase 3: Batch Execution
- Implement batch processing script
- Setup parallel processing
- Configure result outputs
- Implement error handling

### Phase 4: Results Processing
- Export to spreadsheet formats
- Generate hydrodynamic database
- Create visualization plots
- Validate results against benchmarks

### Phase 5: Results Packaging
- Format results for multiple uses
- Create OrcaFlex-ready export files
- Generate comprehensive documentation
- Package for downstream applications

## Testing Strategy

### Unit Tests
- Geometry validation functions
- Configuration file parsing
- Result data conversion
- OrcaFlex API integration

### Integration Tests
- End-to-end workflow execution
- Batch processing reliability
- Data format conversions
- Error recovery mechanisms

### Validation Tests
- Compare with reference cases
- Verify conservation principles
- Check symmetry conditions
- Validate frequency ranges

## Performance Requirements
- Analysis completion: &lt; 2 hours for standard mesh
- Memory usage: &lt; 16 GB RAM
- Parallel efficiency: &gt; 80% on 4 cores
- File I/O: Optimized for network drives

## Security Considerations
- Secure handling of proprietary geometry
- Encrypted storage of results
- Access control for batch execution
- Audit logging of all operations

## Documentation Requirements
- User guide for batch execution
- Technical reference for YAML configuration
- Validation report template
- Integration troubleshooting guide

## Success Criteria
1. ✅ All three geometry formats evaluated
2. ✅ Automated batch processing operational
3. ✅ Results exported in all required formats
4. ✅ OrcaFlex-ready files generated
5. ✅ Validation against known benchmarks
6. ✅ Performance targets achieved

## Dependencies
- OrcaWave v11.0+ with valid license
- OrcaFlex v11.0+ with valid license
- Python 3.8+ with required packages
- Network access to geometry files
- Sufficient computational resources

## Risk Mitigation
- **Geometry Issues**: Pre-validation scripts
- **License Availability**: Queue management system
- **Memory Limitations**: Mesh decimation options
- **Network Latency**: Local caching strategy
- **Solver Convergence**: Adaptive refinement

## Future Enhancements
- Web-based monitoring dashboard
- Cloud computing integration
- Machine learning optimization
- Automated report generation
- Multi-vessel batch processing