graph TB
    %% Central Registry
    subgraph "Central Agent Registry"
        REG[Registry YAML]
        DISC[Auto-Discovery]
        SYNC[Sync Engine]
    end

    %% Delegation Engine
    subgraph "Delegation Engine"
        TASK[Task Analyzer]
        DECOMP[Task Decomposer]
        MATCH[Capability Matcher]
        DECIDE[Decision Engine]
        PREVENT[Circular Prevention]
    end

    %% Communication Layer
    subgraph "Communication Protocol"
        MSG[Message Format]
        QUEUE[Message Queue]
        ASYNC[Async Handler]
        AGG[Result Aggregator]
    end

    %% Performance System
    subgraph "Performance & Analytics"
        METRICS[Metrics Collector]
        ANALYTICS[Analytics Engine]
        LEARN[Learning System]
        DASH[Dashboard]
    end

    %% Specialized Agents
    subgraph "Specialized Agents"
        subgraph "Engineering Agents"
            ORCA[OrcaFlex Agent]
            WAVE[OrcaWave Agent]
            AQWA[AQWA Agent]
        end
        
        subgraph "CAD Agents"
            CAD[CAD Engineering]
            FCAD[FreeCAD Agent]
            GMSH[GMsh Agent]
        end
        
        subgraph "Support Agents"
            DOC[Documentation]
            TEST[Testing]
            DEVOPS[DevOps]
        end
    end

    %% Slash Commands
    subgraph "Slash Commands"
        SPEC[/create-spec]
        MODULE[/create-module-agent]
        EXEC[/execute-tasks]
    end

    %% Cross-Repo
    subgraph "Cross-Repository"
        ASSET[AssetUtilities Hub]
        PROXY[Agent Proxies]
        REPOS[25+ Repositories]
    end

    %% Main Flow Connections
    DISC --> REG
    REG --> SYNC
    SYNC --> ASSET

    SPEC --> TASK
    MODULE --> REG
    EXEC --> DECIDE

    TASK --> DECOMP
    DECOMP --> MATCH
    MATCH --> DECIDE
    DECIDE --> PREVENT
    PREVENT --> MSG

    MSG --> QUEUE
    QUEUE --> ASYNC
    ASYNC --> AGG

    %% Agent Delegation Flows
    DECIDE -.->|delegate| ORCA
    DECIDE -.->|delegate| CAD
    DECIDE -.->|delegate| DOC

    ORCA <-->|coordinate| WAVE
    ORCA <-->|verify| AQWA
    CAD -->|modeling| FCAD
    FCAD -->|meshing| GMSH

    %% Feedback Loops
    AGG --> METRICS
    METRICS --> ANALYTICS
    ANALYTICS --> LEARN
    LEARN -.->|optimize| DECIDE

    %% Cross-Repo Sync
    ASSET <--> PROXY
    PROXY <--> REPOS
    REG --> PROXY

    %% Performance Monitoring
    METRICS --> DASH
    DASH -.->|alerts| DEVOPS

    %% Styling
    classDef registry fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef engine fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef comm fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef perf fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef agent fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef cmd fill:#e0f2f1,stroke:#004d40,stroke-width:2px

    class REG,DISC,SYNC registry
    class TASK,DECOMP,MATCH,DECIDE,PREVENT engine
    class MSG,QUEUE,ASYNC,AGG comm
    class METRICS,ANALYTICS,LEARN,DASH perf
    class ORCA,WAVE,AQWA,CAD,FCAD,GMSH,DOC,TEST,DEVOPS agent
    class SPEC,MODULE,EXEC cmd