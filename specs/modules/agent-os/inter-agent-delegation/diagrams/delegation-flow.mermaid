sequenceDiagram
    participant User
    participant Slash as Slash Command
    participant Engine as Delegation Engine
    participant Registry as Agent Registry
    participant Primary as Primary Agent
    participant Secondary as Secondary Agent
    participant Fallback as Fallback Agent
    participant Analytics as Analytics System

    User->>Slash: /execute-tasks "Complex CAD to FEA workflow"
    
    %% Task Analysis Phase
    Slash->>Engine: Analyze task
    Engine->>Engine: Decompose into subtasks
    Note over Engine: 1. Create CAD model<br/>2. Generate mesh<br/>3. Run analysis
    
    %% Agent Discovery Phase
    Engine->>Registry: Query available agents
    Registry-->>Engine: Return agent capabilities
    Note over Registry: CAD: 0.95 confidence<br/>FreeCAD: 0.90<br/>GMsh: 0.85
    
    %% Delegation Decision Phase
    Engine->>Engine: Calculate confidence scores
    Engine->>Engine: Check delegation rules
    Engine->>Engine: Plan execution path
    
    %% Subtask 1: CAD Model
    Engine->>Primary: Delegate "Create CAD model"
    Note over Primary: CAD Engineering Agent
    Primary->>Primary: Self-assess confidence (0.4)
    Primary->>Secondary: Delegate to FreeCAD
    Note over Secondary: FreeCAD Agent
    Secondary->>Secondary: Execute task
    Secondary-->>Primary: Return model artifact
    Primary-->>Engine: Task complete + artifact
    
    %% Subtask 2: Mesh Generation
    Engine->>Secondary: Delegate "Generate mesh"
    Secondary->>Secondary: Self-assess confidence (0.3)
    Secondary->>Fallback: Delegate to GMsh
    Note over Fallback: GMsh Agent
    Fallback->>Fallback: Execute task
    Fallback-->>Secondary: Return mesh artifact
    Secondary-->>Engine: Task complete + artifact
    
    %% Circular Prevention Example
    rect rgb(255, 230, 230)
        Note over Engine: Circular Prevention Active
        Engine->>Engine: Check delegation chain
        Note over Engine: Chain: User→CAD→FreeCAD→GMsh<br/>Depth: 3 (MAX REACHED)
        Engine->>Engine: Block further delegation
    end
    
    %% Result Aggregation
    Engine->>Engine: Aggregate results
    Engine->>Analytics: Log performance metrics
    Analytics->>Analytics: Update success rates
    Analytics->>Analytics: Adjust confidence scores
    
    %% Return to User
    Engine-->>Slash: Combined results
    Slash-->>User: Task complete with artifacts
    
    %% Learning Feedback
    Analytics-->>Registry: Update agent scores
    Note over Analytics: CAD delegation: +0.02<br/>FreeCAD success: +0.01<br/>GMsh success: +0.03