graph TB
    subgraph "Claude CLI Interface"
        CLI[Claude CLI]
        MCP_Client[MCP Client v1.2]
    end
    
    subgraph "OrcaWave MCP Server"
        MCP_Core[FastMCP 2.0.5+ Core]
        
        subgraph "Hybrid Control Layer"
            COM[COM API Controller]
            Vision[Vision Monitor]
            Sync[State Synchronizer]
            Fallback[Fallback Manager]
        end
        
        subgraph "Domain Intelligence"
            MeshOpt[Mesh Optimizer]
            WavePhys[Wave Physics Engine]
            HydroVal[Hydro Validator]
            Benchmark[Benchmark System]
        end
        
        subgraph "Automation Engine"
            Workflow[Workflow Orchestrator]
            BatchProc[Batch Processor]
            ErrorRec[Error Recovery]
            Templates[Template Manager]
        end
        
        subgraph "MCP Resources"
            R1[orcawave://model/current]
            R2[orcawave://mesh/quality]
            R3[orcawave://results/hydrodynamics]
            R4[orcawave://validation/status]
        end
        
        subgraph "MCP Tools"
            T1[create_vessel]
            T2[import_geometry]
            T3[optimize_mesh]
            T4[run_analysis]
            T5[export_to_orcaflex]
            T6[batch_analysis]
        end
        
        subgraph "Integration Layer"
            OrcaFlexExp[OrcaFlex Exporter]
            ExcelRep[Excel Reporter]
            AQWABench[AQWA Validator]
        end
        
        subgraph "Performance & Security"
            Cache[Multi-tier Cache]
            Monitor[Real-time Monitor]
            Audit[Audit Logger]
            Security[Security Layer]
        end
    end
    
    subgraph "OrcaWave Application"
        OWApp[OrcaWave.exe]
        OWCOM[COM Interface]
        OWGUI[GUI Windows]
        OWEngine[Solver Engine]
        OWData[Data Store]
    end
    
    subgraph "Supporting Agents"
        OWAgent[OrcaWave Agent]
        CADAgent[CAD Agent]
        TestAgent[Testing Agent]
        OFAgent[OrcaFlex Agent]
    end
    
    subgraph "External Services"
        GPT4V[GPT-4 Vision]
        ClaudeV[Claude Vision]
        Redis[Redis Cache]
        FileStore[File Storage]
    end
    
    %% Primary connections
    CLI --> MCP_Client
    MCP_Client -.->|MCP Protocol| MCP_Core
    
    %% Hybrid control
    MCP_Core --> COM
    MCP_Core --> Vision
    COM <--> Sync
    Vision <--> Sync
    Sync --> Fallback
    
    %% COM connections
    COM <--> OWCOM
    OWCOM <--> OWEngine
    OWCOM <--> OWData
    
    %% Vision connections
    Vision --> OWGUI
    Vision --> GPT4V
    Vision --> ClaudeV
    
    %% Domain intelligence
    COM --> MeshOpt
    COM --> WavePhys
    COM --> HydroVal
    HydroVal --> Benchmark
    
    %% Automation
    MCP_Core --> Workflow
    Workflow --> BatchProc
    Workflow --> ErrorRec
    Workflow --> Templates
    
    %% Resources mapping
    COM --> R1
    MeshOpt --> R2
    OWEngine --> R3
    HydroVal --> R4
    
    %% Tools mapping
    Workflow --> T1
    Workflow --> T2
    MeshOpt --> T3
    BatchProc --> T4
    OrcaFlexExp --> T5
    BatchProc --> T6
    
    %% Integration
    R3 --> OrcaFlexExp
    R3 --> ExcelRep
    R3 --> AQWABench
    
    %% Performance
    MCP_Core --> Cache
    Cache --> Redis
    MCP_Core --> Monitor
    MCP_Core --> Security
    Security --> Audit
    
    %% Agent coordination
    MCP_Core -.->|Delegates| OWAgent
    OWAgent -.->|Coordinates| CADAgent
    OWAgent -.->|Validates| TestAgent
    OWAgent -.->|Exports| OFAgent
    
    %% Storage
    OWData --> FileStore
    Cache --> FileStore
    
    %% Styling
    classDef core fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef control fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef domain fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef integration fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef external fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    classDef agent fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class MCP_Core core
    class COM,Vision,Sync,Fallback control
    class MeshOpt,WavePhys,HydroVal,Benchmark domain
    class OrcaFlexExp,ExcelRep,AQWABench integration
    class GPT4V,ClaudeV,Redis,FileStore external
    class OWAgent,CADAgent,TestAgent,OFAgent agent