graph TB
    subgraph "Claude CLI Layer"
        CLI[Claude CLI Interface]
        MCP_Client[MCP Client v1.2]
    end
    
    subgraph "MCP Server Template 2025"
        MCP_Server[FastMCP 2.0.5+ Core]
        
        subgraph "Security Layer"
            Auth[OAuth 2.0/OIDC]
            Sandbox[Container Sandbox]
            RateLimit[Rate Limiter]
            Audit[Audit Logger]
        end
        
        subgraph "Core Components"
            SC[Screen Capture Module]
            VA[Vision Analyzer ML]
            GC[GUI Controller]
            CM[Config Manager]
        end
        
        subgraph "Performance Layer"
            L1Cache[L1 Memory Cache]
            L2Cache[L2 Redis Cache]
            L3Cache[L3 CDN Cache]
            GPU[GPU Acceleration]
        end
        
        subgraph "Agent System"
            AR[Agent Registry]
            AC[Agent Coordinator]
            CTX[Context Manager]
            Delegation[Task Delegator]
        end
        
        subgraph "MCP Resources"
            R1[screenshot://current]
            R2[ui://elements]
            R3[state://application]
            R4[health://status]
        end
        
        subgraph "MCP Tools"
            T1[navigate]
            T2[interact]
            T3[analyze]
            T4[execute_sequence]
            T5[self_heal]
        end
        
        subgraph "MCP Prompts"
            P1[understand_ui]
            P2[find_element]
            P3[verify_state]
            P4[generate_test]
        end
        
        subgraph "Observability"
            OTel[OpenTelemetry]
            Metrics[Prometheus]
            Logs[ELK Stack]
        end
    end
    
    subgraph "Specialized Agents"
        GUI_Agent[GUI Automation Agent]
        Vision_Agent[Vision Analysis Agent]
        Test_Agent[Testing Agent]
        Domain_Agent[Domain Expert Agent]
    end
    
    subgraph "External Services"
        GPT4[GPT-4 Vision API]
        Claude_Vision[Claude Vision API]
        Local_Model[Local Vision Model]
    end
    
    subgraph "Target Application"
        GUI_App[GUI Program]
        App_Window[Application Window]
        UI_Elements[UI Elements]
    end
    
    subgraph "Platform Layer"
        PyAutoGUI[PyAutoGUI]
        RobotJS[RobotJS]
        OS_API[OS Native APIs]
    end
    
    %% Connections
    CLI --> MCP_Client
    MCP_Client -.->|MCP Protocol| MCP_Server
    
    MCP_Server --> SC
    MCP_Server --> VA
    MCP_Server --> GC
    MCP_Server --> CM
    MCP_Server --> AR
    
    SC --> R1
    VA --> R2
    GC --> R3
    
    GC --> T1
    GC --> T2
    VA --> T3
    AC --> T4
    
    VA --> P1
    VA --> P2
    Test_Agent --> P3
    
    AR --> AC
    AC --> CTX
    
    AC -.->|Delegates| GUI_Agent
    AC -.->|Delegates| Vision_Agent
    AC -.->|Delegates| Test_Agent
    AC -.->|Delegates| Domain_Agent
    
    VA --> GPT4
    VA --> Claude_Vision
    VA --> Local_Model
    
    SC --> App_Window
    GC --> UI_Elements
    
    GC --> PyAutoGUI
    GC --> RobotJS
    SC --> OS_API
    
    GUI_App --> App_Window
    App_Window --> UI_Elements
    
    %% Styling
    classDef core fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef agent fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef resource fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef tool fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class MCP_Server,SC,VA,GC,CM core
    class GUI_Agent,Vision_Agent,Test_Agent,Domain_Agent,AR,AC,CTX agent
    class GPT4,Claude_Vision,Local_Model,PyAutoGUI,RobotJS,OS_API external
    class R1,R2,R3 resource
    class T1,T2,T3,T4 tool