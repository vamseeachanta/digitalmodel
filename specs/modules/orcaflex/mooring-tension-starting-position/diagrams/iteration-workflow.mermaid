flowchart TD
    START([Start Analysis]) --> LOAD[Load Configuration]
    LOAD --> BUILD[Build OrcaFlex Model]
    BUILD --> INIT[Initialize Parameters]
    
    INIT --> ITER{Iteration Loop}
    
    ITER --> CHECK_MAX{Max Iterations?}
    CHECK_MAX -->|Yes| STOP_MAX[Stop: Max Iterations]
    CHECK_MAX -->|No| RUN[Run Static Analysis]
    
    RUN --> EXTRACT[Extract Forces]
    EXTRACT --> CALC[Calculate Force Balance]
    
    CALC --> CHECK_Z{Z Force Balanced?}
    CHECK_Z -->|No| OPT_Z[Optimize Z Position]
    CHECK_Z -->|Yes| CHECK_XY{X,Y Forces Balanced?}
    
    OPT_Z --> UPDATE_Z[Update Vessel Z]
    UPDATE_Z --> CHECK_XY
    
    CHECK_XY -->|No| OPT_T[Optimize Line Tensions]
    CHECK_XY -->|Yes| CHECK_CONV{Check Convergence}
    
    OPT_T --> UPDATE_T[Update Tensions]
    UPDATE_T --> CHECK_CONV
    
    CHECK_CONV --> EVAL_CONV{Converged?}
    
    EVAL_CONV -->|Tension Change < 10kN| STOP_TENSION[Stop: Tension Converged]
    EVAL_CONV -->|Force Balance Achieved| STOP_FORCE[Stop: Forces Balanced]
    EVAL_CONV -->|Improvement < 1%| STOP_IMPROVE[Stop: No Improvement]
    EVAL_CONV -->|Not Converged| UPDATE_HIST[Update History]
    
    UPDATE_HIST --> ITER
    
    STOP_MAX --> REPORT[Generate Report]
    STOP_TENSION --> REPORT
    STOP_FORCE --> REPORT
    STOP_IMPROVE --> REPORT
    
    REPORT --> SAVE[Save Results]
    SAVE --> END([End])
    
    %% Styling
    style START fill:#4caf50,stroke:#2e7d32,color:#fff
    style END fill:#f44336,stroke:#c62828,color:#fff
    
    style CHECK_MAX fill:#ffeb3b,stroke:#f57c00
    style CHECK_Z fill:#ffeb3b,stroke:#f57c00
    style CHECK_XY fill:#ffeb3b,stroke:#f57c00
    style CHECK_CONV fill:#ffeb3b,stroke:#f57c00
    style EVAL_CONV fill:#ffeb3b,stroke:#f57c00
    
    style OPT_Z fill:#2196f3,stroke:#0d47a1,color:#fff
    style OPT_T fill:#2196f3,stroke:#0d47a1,color:#fff
    
    style STOP_MAX fill:#ff9800,stroke:#e65100
    style STOP_TENSION fill:#4caf50,stroke:#2e7d32
    style STOP_FORCE fill:#4caf50,stroke:#2e7d32
    style STOP_IMPROVE fill:#ff9800,stroke:#e65100