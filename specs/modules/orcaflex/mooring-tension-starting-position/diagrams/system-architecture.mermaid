graph TB
    %% Main System Architecture
    
    subgraph "Input Layer"
        CONFIG[Configuration YAML]
        MODEL[OrcaFlex Model .dat]
        CONSTRAINTS[Constraints & Limits]
    end
    
    subgraph "Core System"
        subgraph "Model Builder"
            MB[OrcaFlexModelBuilder]
            VF[Vessel Fixation 0DOF]
            ML[Mooring Line Setup]
            FN[Fender Configuration]
        end
        
        subgraph "Analysis Engine"
            SA[Static Analysis]
            SIM[.sim Generation]
            RE[Results Extraction]
        end
        
        subgraph "Force Analysis"
            FA[ForceAnalyzer]
            GF[Global Forces]
            LF[Local Forces]
            FB[Force Balance Calculator]
        end
        
        subgraph "Optimization"
            PO[Position Optimizer]
            TO[Tension Optimizer]
            NR[Newton-Raphson Solver]
            MO[Multi-Variable Optimizer]
        end
        
        subgraph "Convergence"
            CT[ConvergenceTracker]
            CC[Convergence Criteria]
            HT[History Tracking]
            DV[Divergence Detection]
        end
    end
    
    subgraph "Integration Layer"
        MM[mooring.py Module]
        UR[Universal Runner]
        API[OrcaFlex Python API]
    end
    
    subgraph "Output Layer"
        RR[Results Reporter]
        VZ[Visualization]
        EX[Excel Export]
        PD[PDF Reports]
    end
    
    %% Connections
    CONFIG --> MB
    MODEL --> MB
    CONSTRAINTS --> PO
    CONSTRAINTS --> TO
    
    MB --> VF
    MB --> ML
    MB --> FN
    
    VF --> SA
    ML --> SA
    FN --> SA
    
    SA --> SIM
    SIM --> RE
    RE --> FA
    
    FA --> GF
    FA --> LF
    GF --> FB
    LF --> FB
    
    FB --> PO
    FB --> TO
    
    PO --> NR
    TO --> MO
    
    NR --> CT
    MO --> CT
    
    CT --> CC
    CT --> HT
    CT --> DV
    
    CC -->|Not Converged| SA
    CC -->|Converged| RR
    
    MM --> FA
    UR --> SA
    API --> MB
    API --> SA
    
    RR --> VZ
    RR --> EX
    RR --> PD
    
    style CONFIG fill:#e1f5fe
    style MODEL fill:#e1f5fe
    style CONSTRAINTS fill:#e1f5fe
    
    style MB fill:#fff3e0
    style FA fill:#fff3e0
    style PO fill:#fff3e0
    style TO fill:#fff3e0
    style CT fill:#fff3e0
    
    style RR fill:#e8f5e9
    style VZ fill:#e8f5e9
    style EX fill:#e8f5e9
    style PD fill:#e8f5e9