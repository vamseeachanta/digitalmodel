# Mooring Tension Iteration File Documentation

## Overview
This document provides comprehensive mapping of all files in the mooring tension iteration workflow, their purposes, and data flow relationships.

## 🆕 Standardized Folder Structure (NEW)
**IMPORTANT**: A new standardized folder structure has been defined for all OrcaFlex analyses to ensure repeatability and consistency. See `ORCAFLEX_FOLDER_STANDARD.md` for complete details.

### Key Changes:
- All `.dat` files must be in `.dat/` subdirectories
- All `.sim` files must be in `.sim/` subdirectories  
- Clear separation of original, modified, and archived files
- Standardized paths for configs, results, and logs

### Migration:
Run `python migrate_to_standard.py` to automatically reorganize files into the standard structure.

## Input Files

### Primary Model Files
| File | Type | Purpose | Critical |
|------|------|---------|----------|
| `fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof.dat` | OrcaFlex Model | Primary vessel static analysis model with 6DOF configuration | ✅ Critical |
| `fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof.sim` | OrcaFlex Simulation | Generated simulation file (45MB) containing analysis results | ✅ Critical |

### Configuration Files
| File | Type | Purpose | Critical |
|------|------|---------|----------|
| `dm_ofx_anal_mooring_fsts_l015_125km3_pb.yml` | Analysis Config | Mooring analysis configuration for iteration workflow | ✅ Critical |
| `dm_ofx_post_fsts_lngc.yml` | Post-Processing Config | Post-processing configuration for LNGC vessel results | ✅ Critical |
| `fsts_l015_125km3_pb_target_mooring_pretension.csv` | Target Values | Target pretension values for 16 mooring lines with tolerances | ✅ Critical |
| `_target_fender_force.csv` | Fender Config | Fender force-displacement properties | ⚠️ Optional |

### Script Files
| File | Type | Purpose | Critical |
|------|------|---------|----------|
| `run_models_to_sim.py` | Python Script | Converts .dat/.yml models to .sim files with parallel processing | ✅ Critical |
| `dm_iterator.sh` | Bash Script | Main iteration orchestrator script | ✅ Critical |
| `dm_pretension_iteration.sh` | Bash Script | Pretension adjustment iteration logic | ✅ Critical |

### Documentation Files
| File | Type | Purpose | Critical |
|------|------|---------|----------|
| `COMMAND_REFERENCE.md` | Documentation | Complete command reference for run_models_to_sim.py | 📚 Reference |
| `SIMPLIFIED_COMMANDS.md` | Documentation | Simplified command patterns without redundancy | 📚 Reference |
| `USAGE.md` | Documentation | Usage guide with keyword arguments | 📚 Reference |
| `run_models_to_sim_updates.md` | Documentation | Enhancement history and changelog | 📚 Reference |
| `task_0.1_verification_report.md` | Documentation | Verification report for Task 0.1 execution | 📚 Reference |

## Output Files

### Generated Analysis Files
| File | Location | Purpose | Source |
|------|----------|---------|--------|
| `fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof.sim` | `go-by/` | OrcaFlex simulation results | Generated from .dat |
| `fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof_pretension_analysis.csv` | `results/` | Pretension analysis results with force components | Post-processing |
| `dm_ofx_anal_mooring_fsts_l015_125km3_pb.yml` | `results/` | Updated analysis configuration | Iteration output |
| `dm_ofx_post_fsts_lngc.yml` | `results/` | Updated post-processing configuration | Post-process output |

### Log Files
| File | Location | Purpose | Generated By |
|------|----------|---------|-------------|
| `dm_ofx_anal_mooring_fsts_l015_125km3_pb.log` | `logs/` | Analysis execution log | dm_iterator.sh |
| `dm_ofx_post_fsts_lngc.log` | `logs/` | Post-processing execution log | dm_iterator.sh |

### Data Output Directories
| Directory | Purpose | Contents |
|-----------|---------|----------|
| `results/Data/` | CSV data outputs | Currently empty (pending execution) |
| `results/Plot/` | Visualization outputs | Currently empty (pending execution) |

## File Flow Diagram

```
1. INPUT PHASE
   ├── fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof.dat (OrcaFlex model)
   ├── fsts_l015_125km3_pb_target_mooring_pretension.csv (target values)
   └── dm_ofx_anal_mooring_fsts_l015_125km3_pb.yml (config)
   
2. PROCESSING PHASE
   ├── run_models_to_sim.py
   │   └── Generates: fsts_l015_hwl_125km3_l100_pb_vessel_statics_6dof.sim
   │
   ├── dm_iterator.sh (orchestrator)
   │   ├── Calls: dm_pretension_iteration.sh
   │   ├── Reads: target CSV files
   │   └── Updates: mooring line lengths
   │
   └── dm_pretension_iteration.sh
       ├── Adjusts: line segment lengths
       ├── Runs: OrcaFlex static analysis
       └── Checks: convergence criteria

3. OUTPUT PHASE
   ├── results/
   │   ├── *_pretension_analysis.csv (force components)
   │   ├── Data/ (CSV exports)
   │   └── Plot/ (visualizations)
   └── logs/
       ├── dm_ofx_anal_mooring_fsts_l015_125km3_pb.log
       └── dm_ofx_post_fsts_lngc.log
```

## Critical vs Optional Files

### Critical Files (Required for workflow)
- ✅ `*.dat` or `*.yml` - OrcaFlex model files
- ✅ `*_target_mooring_pretension.csv` - Target tension values
- ✅ `run_models_to_sim.py` - Simulation generator
- ✅ `dm_iterator.sh` - Main orchestrator
- ✅ Configuration YML files for analysis

### Optional Files (Enhanced functionality)
- ⚠️ `_target_fender_force.csv` - Only if fender forces needed
- 📚 Documentation files - For reference only
- 📊 Visualization outputs - Generated post-analysis

## Data Format Specifications

### Target Pretension CSV Format
```csv
ObjectName,target_tension,line_length,line_EA,section_to_be_modified,calculated_length,tolerance
Line01,80,"[11.0, None]","[1.17e3, 47.7e3]",1,28.03639897,50
```

### Pretension Analysis Output Format
Expected columns in `*_pretension_analysis.csv`:
- Line name
- Tension magnitude (kN)
- X-component force
- Y-component force  
- Z-component force
- Azimuth angle
- Declination angle

## File Size Considerations
- `.sim` files: ~45MB each (binary format)
- `.dat` files: ~1-5MB (text format)
- `.csv` outputs: <1MB typically
- Log files: <100KB typically

## Next Steps for Implementation
1. Verify CSV output format from existing analysis
2. Implement parser for pretension_analysis.csv
3. Add visualization components for force directions
4. Create stiffness calculation from force-displacement data