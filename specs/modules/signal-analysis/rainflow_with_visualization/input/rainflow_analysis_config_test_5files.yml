# Rainflow Analysis with Visualization Configuration - TEST 5 FILES
# Signal Analysis Module for Fatigue Assessment
# Created: 2025-01-24
# Version: 1.0.0 - Test Configuration for 5 Files

# ============================================================================
# PROJECT IDENTIFICATION
# ============================================================================
project:
  name: "Rainflow Counting and Signal Analysis - 5 File Test"
  description: "Test run with 5 files for production validation"
  analysis_type: "rainflow-with-visualization"
  project_id: "RF-VIS-TEST5"
  version: "1.0.0"
  date: "2025-01-24"
  
# ============================================================================
# INPUT DATA CONFIGURATION
# ============================================================================
input_data:
  # Time trace data configuration
  timetrace:
    # Using test data folder with existing files
    data_folder: "D:\\1522\\ctr9\\fatigue_wsp_method\\07c_fatigue\\output\\scaled_loads\\tension_data"
    
    # Input file format
    file_format: "csv"
    name_pattern: "{config}_FC{fc_number:03d}_Strut{strut_number}_tension.csv"
    # Limit to first 5 files for testing
    filter_pattern: "fsts_l015_125km3_l100_pb_FC001_Strut[1-5]_tension.csv"

    # Column containing the tension/stress data
    data_column: "Scaled Tension (kN)"
    
    # Time column (if present)
    time_column: "time"
    
    # Sampling parameters
    sampling:
      dt: 0.1  # Time step in seconds
      auto_detect: true  # Auto-detect from time column if available
    
  # Data preprocessing options
  preprocessing:
    # Remove mean (detrend)
    remove_mean: false
    
    # Apply filtering (DISABLED - not used in production)
    filter:
      enabled: false  # Filtering not applied
      type: "butterworth"
      cutoff_freq: 40.0  # Hz (not used when disabled)
      order: 4
      
# ============================================================================
# RAINFLOW COUNTING METHOD
# ============================================================================
rainflow_counting:
  # Counting method configuration
  method:
    # Algorithm type
    algorithm: "ASTM E1049"  # Standard rainflow counting algorithm
    
    # Determine time trace length from data
    auto_detect_length: true
    
  # Binning parameters for stress RANGE (always positive)
  binning:
    # Number of bins for cycle counting
    num_bins: 50
    
    # Binning method
    method: "linear"  # Linear binning for stress range
    
    # Minimum bin value for RANGE (always positive)
    min_range: 0.0  # Stress range starts from zero
    
    # Maximum bin value for RANGE - PRODUCTION VALUE
    max_range: 10000  # Maximum expected stress range in kN - increased for production data
    
    # Binning for MEAN values (can be negative) - PRODUCTION VALUES
    mean_binning:
      enabled: true
      min_mean: -5000  # Minimum mean stress (can be negative/compression) - scaled for production
      max_mean: 5000   # Maximum mean stress (positive/tension) - scaled for production
    
  # Cycle extraction parameters
  cycle_extraction:
    # Half-cycle or full-cycle counting
    count_type: "full-cycles"  # Changed to full cycles (2, 2.5, 5.5 etc.)
    
    # Minimum range threshold (cycles below this are ignored)
    min_range_threshold: 0.0
    
    # Residue handling
    handle_residue: true
    
  # Cycle scaling parameters
  cycle_scaling:
    # Output cycle counts for time trace duration
    timetrace_cycles: true
    
    # Scale to annual cycles based on time trace length
    annual_cycles: true
    scaling_method: "simple"  # annual_cycles = timetrace_cycles * (8760 / timetrace_hours)
    
    # Annual duration (hours)
    annual_hours: 8760  # 365 days * 24 hours
    
    # Use actual time trace duration from data
    use_actual_duration: true
    
# ============================================================================
# FFT ANALYSIS CONFIGURATION
# ============================================================================
fft_analysis:
  # Window configuration
  window:
    # Window type for FFT
    type: "hanning"  # Options: hanning, hamming, blackman, bartlett, rectangular
    
    # Window length in seconds
    length_seconds: 500
    
    # Overlap percentage between windows
    overlap_percent: 50
    
  # FFT parameters
  parameters:
    # Sampling frequency (Hz) - auto-detect from data if not specified
    sampling_frequency: "auto"  # Will detect from time column (expected 0.1s = 10 Hz)
    expected_dt: 0.1  # Expected time step in seconds
    
    # Number of FFT points (power of 2)
    nfft: "auto"  # Will use next power of 2 from window length
    
    # Frequency range for plotting (Hz)
    freq_range:
      min: 0.0
      max: 5.0  # Typical for structural dynamics
      
  # Spectral analysis options
  spectral:
    # Type of spectrum to compute
    spectrum_type: "power"  # Options: power, amplitude, psd
    
    # Scaling
    scaling: "density"  # Options: density, spectrum
    
    # Detrend before FFT
    detrend: "constant"  # Options: constant, linear, none
    
# ============================================================================
# OUTPUT CONFIGURATION
# ============================================================================
output:
  # Output folder structure
  folders:
    # Base output folder - PRODUCTION LOCATION for test
    base: "D:\\1522\\ctr9\\fatigue_wsp_method\\07c_fatigue\\output"
    
    # Rainflow results folder
    rainflow_results: "rainflow_test5"
    
    # Visualization folder
    visualizations: "visualization_test5"
    
  # File naming pattern
  file_naming:
    # Pattern for output files
    pattern: "{config}_FC{fc_number:03d}_Strut{strut_number}_{type}"
    
    # File types
    types:
      rainflow: "rainflow"
      fft: "fft"
      summary: "summary"
      
  # Output file formats
  formats:
    # Rainflow counting results
    rainflow_output:
      format: "csv"
      include_headers: true
      columns:
        - "Range (kN)"  # Always positive (magnitude of stress cycle)
        - "Mean (kN)"   # Can be positive or negative
        - "Cycles_TimeTrace"
        - "Cycles_Annual"
        - "Bin_Number"
        - "Damage_Contribution"
        
    # Summary statistics
    summary_output:
      format: "csv"
      include_metadata: true
      
    # Individual file outputs
    individual_outputs: true
      
    # Aggregate summary report
    aggregate_summary:
      enabled: true
      filename: "rainflow_analysis_summary_test5.csv"
      include_statistics: true
      statistics:
        - "total_cycles"
        - "max_range"
        - "mean_range"
        - "damage_sum"
        - "fatigue_life_estimate"
      
# ============================================================================
# VISUALIZATION CONFIGURATION
# ============================================================================
visualization:
  # FFT visualization
  fft_plot:
    # Enable FFT plot generation
    enabled: true
    
    # Output format
    format: "png"
    
    # Plot settings
    settings:
      figure_size: [12, 8]
      dpi: 150
      grid: true
      log_scale_y: true
      
    # Plot components
    components:
      - "magnitude_spectrum"
      - "phase_spectrum"
      - "power_spectral_density"
      
  # Rainflow visualization
  rainflow_plot:
    # Enable rainflow visualization
    enabled: true
    
    # Output format
    format: "png"
    
    # Plot settings
    settings:
      figure_size: [14, 10]
      dpi: 150
      
    # Plot components (in priority order)
    components:
      - "time_trace_with_cycles"  # Time trace with identified peaks/valleys/cycles
      - "rainflow_matrix"  # 3D matrix plot (Range vs Mean vs Count)
      - "cycle_histogram"  # Cycle count histogram by stress range
      - "range_mean_scatter"  # Range-mean scatter plot
      - "cumulative_damage"  # Cumulative damage plot
      
  # Time series visualization
  timeseries_plot:
    # Enable time series plot
    enabled: true
    
    # Plot settings
    settings:
      figure_size: [14, 6]
      show_peaks: true
      show_valleys: true
      highlight_cycles: false
      
  # Combined report
  combined_report:
    # Generate combined PDF report (DISABLED - requires additional libraries)
    enabled: false  # Set to true if PDF libraries are installed
    format: "pdf"
    include_tables: true
    include_statistics: true
    
# ============================================================================
# PROCESSING OPTIONS
# ============================================================================
processing:
  # Parallel processing
  parallel:
    enabled: false  # Disabled for test run
    num_workers: 1
    
  # Batch processing
  batch:
    # Process multiple files
    process_all_files: true
    
    # Continue on error
    continue_on_error: true
    
  # Memory management
  memory:
    # Maximum memory usage (GB)
    max_memory_gb: 8
    
    # Use memory mapping for large files
    use_mmap: true
    
# ============================================================================
# VALIDATION AND QUALITY CONTROL
# ============================================================================
validation:
  # Input validation
  input_checks:
    # Check for data completeness
    check_completeness: true
    
    # Maximum allowed missing data (%)
    max_missing_percent: 5.0
    
    # Check for outliers
    check_outliers: true
    outlier_threshold: 6.0  # Standard deviations
    
  # Output validation
  output_checks:
    # Verify rainflow sum equals input cycles
    verify_cycle_count: true
    
    # Check for negative ranges
    check_negative_ranges: true
    
    # Validate FFT results
    validate_fft: true
    
  # Quality metrics
  quality_metrics:
    # Calculate signal-to-noise ratio
    calculate_snr: true
    
    # Calculate statistical moments
    calculate_moments: true
    
    # Generate quality report
    generate_qc_report: true
    
# ============================================================================
# LOGGING AND DEBUGGING
# ============================================================================
logging:
  # Logging level
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
  
  # Log file location
  log_file: "rainflow_analysis_test5.log"
  
  # Console output
  console_output: true
  
  # Include timestamps
  include_timestamps: true
  
  # Performance logging
  log_performance: true
  
# ============================================================================
# METADATA
# ============================================================================
metadata:
  # Configuration metadata
  created_date: "2025-01-24"
  created_by: "Signal Analysis Configuration Tool"
  last_modified: "2025-01-24"
  config_version: "1.0.0"
  production_ready: false
  test_config: true
  
  # Analysis description
  notes: |
    TEST CONFIGURATION - 5 FILES ONLY (PRODUCTION OUTPUT PATH)
    
    This is a test configuration to validate production settings with only 5 files.
    Using production binning ranges (10000 kN max range, ±5000 kN mean range)
    and production output paths (D:\1522\ctr9\fatigue_wsp_method\07c_fatigue\output)
    but processing only the first 5 struts from FC001 configuration.
    
    Files to be processed:
    1. fsts_l015_125km3_l100_pb_FC001_Strut1_scaled_tension.csv
    2. fsts_l015_125km3_l100_pb_FC001_Strut2_scaled_tension.csv
    3. fsts_l015_125km3_l100_pb_FC001_Strut3_scaled_tension.csv
    4. fsts_l015_125km3_l100_pb_FC001_Strut4_scaled_tension.csv
    5. fsts_l015_125km3_l100_pb_FC001_Strut5_scaled_tension.csv
    
  # References
  references:
    - "ASTM E1049-85: Standard Practices for Cycle Counting in Fatigue Analysis"
    - "Downing, S. D., Socie, D. F. (1982). Simple rainflow counting algorithms"